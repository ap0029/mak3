
(function(){if(typeof progress=="undefined"){progress={}}if(typeof progress.data=="undefined"){progress.data={}}progress.util={};progress.util.Observable=function(){function c(h,g,f,d){return h.filter(function(j){if(j.fn!==g||j.scope!==f||j.operation!==d){return j}},this)}this.validateSubscribe=function(f,d,g){if(f.length>=2&&(typeof f[0]=="string")&&(typeof f[1]=="string")){g.operation=f[1];g.fn=f[2];g.scope=f[3]}else{if(f.length>=2&&(typeof f[0]=="string")&&(typeof f[1]=="function")){g.operation=undefined;g.scope=f[2];g.fn=f[1]}else{throw new Error()}}};this.subscribe=function(d,f,h,g){if(!d){throw new Error(msg.getMsgText("jsdoMSG037",this.toString(),"subscribe"))}if(typeof d!=="string"){throw new Error(msg.getMsgText("jsdoMSG033",this.toString(),"subscribe",msg.getMsgText("jsdoMSG039")))}this._events=this._events||{};d=d.toLowerCase();var l={fn:undefined,scope:undefined,operation:undefined};try{this.validateSubscribe(arguments,d,l)}catch(j){throw new Error(msg.getMsgText("jsdoMSG033",this.toString(),"subscribe",j.message))}var k=this._events[d]||[];k=c(k,l.fn,l.scope,l.operation);k.push(l);this._events[d]=k;return this};this.unsubscribe=function(d,f,h,g){if(!d){throw new Error(msg.getMsgText("jsdoMSG037",this.toString(),"unsubscribe"))}if(typeof d!=="string"){throw new Error(msg.getMsgText("jsdoMSG033",this.toString(),"unsubscribe",msg.getMsgText("jsdoMSG037")))}this._events=this._events||{};d=d.toLowerCase();var l={fn:undefined,scope:undefined,operation:undefined};try{this.validateSubscribe(arguments,d,l)}catch(j){throw new Error(msg.getMsgText("jsdoMSG033",this.toString(),"unsubscribe",j.message))}var k=this._events[d]||[];if(k.length>0){this._events[d]=c(k,l.fn,l.scope,l.operation)}return this};this.trigger=function(d,f,g){if(!d){throw new Error(msg.getMsgText("jsdoMSG037",this.toString(),"trigger"))}this._events=this._events||{};d=d.toLowerCase();var h=this._events[d]||[];if(h.length>0){var j;var g=Array.prototype.slice.call(arguments);if((arguments.length>=2)&&(typeof arguments[0]=="string")&&(typeof arguments[1]=="string")){j=arguments[1];g=g.length>2?g.slice(2):[]}else{if(arguments.length>=1&&(typeof(d)=="string")){j=undefined;g=g.length>1?g.slice(1):[]}else{throw new Error(msg.getMsgText("jsdoMSG033",this.toString(),"trigger",e.message))}}h.forEach(function(k){if(k.operation===j){k.fn.apply(k.scope,g)}})}return this};this.unsubscribeAll=function(d,f){if(d){this._events=this._events||{};if(typeof(d)=="string"){d=d.toLowerCase();var g=this._events[d]||[];g.forEach(function(h){if(h.operation){this.unsubscribe(d,h.operation,h.fn,h.scope)}else{this.unsubscribe(d,h.fn,h.scope)}},this)}}else{this._events={}}return this}};progress.data.LocalStorage=function a(){if(typeof(localStorage)=="undefined"){throw new Error("Error: No support for localStorage")}this.saveToLocalStorage=function(d,c){localStorage.setItem(d,JSON.stringify(c))};this.readFromLocalStorage=function(f){var c=localStorage.getItem(f);var d=null;if(c!==null){try{d=JSON.parse(c)}catch(g){d=null}}return d};this.clearLocalStorage=function(c){localStorage.removeItem(c)}};progress.util._convertToABLWhereString=function(k,c){var r=[],h=c.logic||"and",q,g,n,m,p,f,o,j,d=c.filters,l={eq:"=",neq:"<>",gt:">",gte:">=",lt:"<",lte:"<=",contains:"INDEX",doesnotcontain:"INDEX",endswith:"R-INDEX",startswith:"BEGINS"};for(q=0,g=d.length;q<g;q=q+1){c=d[q];n=c.field;o=c.value;if(c.filters){c=progress.util._convertToABLWhereString(k,c)}else{f=l[c.operator];if(f===undefined){throw new Error("The operator "+c.operator+" is not valid.")}if(f&&o!==undefined){m=jQuery.type(o);if(m==="string"){p="'{1}'";o=o.replace(/'/g,"''")}else{if(m==="date"){j=k._getABLType(n);if(j==="DATE"){p="DATE({1:MM, dd, yyyy})"}else{if(j==="DATETIME-TZ"){p="DATETIME-TZ({1:MM, dd, yyyy, HH, mm, ss, fff, zzz})"}else{p="DATETIME({1:MM, dd, yyyy, HH, mm, ss, fff})"}}}else{p="{1}"}}if(f==="INDEX"||f==="R-INDEX"){if(m!=="string"){throw new Error("Error parsing filter object. The operator "+c.operator+" requires a string value")}if(c.operator==="doesnotcontain"){p="{0}({2}, "+p+") = 0"}else{if(c.operator==="contains"){p="{0}({2}, "+p+") > 0"}else{p="{2} MATCHES '*{1}'"}}}else{p="{2} {0} "+p}c=progress.util._format(p,f,o,n)}}r.push(c)}c=r.join(" "+h+" ");if(r.length>1){c="("+c+")"}return c};progress.util._format=function(d){var f=arguments,c=/\{(\d+)(:[^\}]+)?\}/g;return d.replace(c,function(h,g,j){var k=f[parseInt(g,10)+1];return progress.util._toString(k,j?j.substring(1):"")})};progress.util._toString=function(d,c){var f;if(c){if(Object.prototype.toString.call(d)==="[object Date]"){return progress.util._formatDate(d,c)}}if(typeof d==="number"){f=d.toString()}else{f=(d!==undefined?d:"")}return f};progress.util._pad=function(f,g){var d=["","0","00","000","0000"],c;f=f+"";g=g||2;c=g-f.length;if(c){return d[g].substring(0,c)+f}return f};progress.util._formatDate=function(c,d){var f=/dddd|ddd|dd|d|MMMM|MMM|MM|M|yyyy|yy|HH|H|hh|h|mm|m|fff|ff|f|tt|ss|s|zzz|"[^"]*"|'[^']*'/g;return d.replace(f,function(j){var k;var g;var h;if(j==="d"){g=c.getDate()}else{if(j==="dd"){g=progress.util._pad(c.getDate())}else{if(j==="ddd"){g=days.namesAbbr[c.getDay()]}else{if(j==="dddd"){g=days.names[c.getDay()]}else{if(j==="M"){g=c.getMonth()+1}else{if(j==="MM"){g=progress.util._pad(c.getMonth()+1)}else{if(j==="MMM"){g=months.namesAbbr[c.getMonth()]}else{if(j==="MMMM"){g=months.names[c.getMonth()]}else{if(j==="yy"){g=progress.util._pad(c.getFullYear()%100)}else{if(j==="yyyy"){g=progress.util._pad(c.getFullYear(),4)}else{if(j==="h"){g=c.getHours()%12||12}else{if(j==="hh"){g=progress.util._pad(c.getHours()%12||12)}else{if(j==="H"){g=c.getHours()}else{if(j==="HH"){g=progress.util._pad(c.getHours())}else{if(j==="m"){g=c.getMinutes()}else{if(j==="mm"){g=progress.util._pad(c.getMinutes())}else{if(j==="s"){g=c.getSeconds()}else{if(j==="ss"){g=progress.util._pad(c.getSeconds())}else{if(j==="f"){g=math.floor(c.getMilliseconds()/100)}else{if(j==="ff"){g=c.getMilliseconds();if(g>99){g=math.floor(g/10)}g=progress.util._pad(g)}else{if(j==="fff"){g=progress.util._pad(c.getMilliseconds(),3)}else{if(j==="zzz"){k=c.getTimezoneOffset();h=k<0;g=(h?"+":"-")+k}}}}}}}}}}}}}}}}}}}}}}return g!==undefined?g:j.slice(1,j.length-1)})};progress.util.jsdoSettingsProcessor=function b(c){if(typeof c==="object"){if(c.authenticationModel===undefined||c.authenticationModel===""){c.authenticationModel="ANONYMOUS"}}}})();(function(){var a=20,m=["none","create","read","update","delete","submit"],g=["","created","","modified","deleted"];if(typeof progress==="undefined"){progress={}}if(typeof progress.data==="undefined"){progress.data={}}progress.data._nextid=0;progress.data._uidprefix=""+(Date.now?Date.now():(new Date().getTime()));var f=999999999999999;progress.data._getNextId=function(){var n=++progress.data._nextid;if(n>=f){progress.data._nextid=n=1;progress.data._uidprefix=""+(Date.now?Date.now():(new Date().getTime()))}return progress.data._uidprefix+"-"+n};var b={};b.msgs={};b.msgs.jsdoMSG000="JSDO, Internal Error: {1}";b.msgs.jsdoMSG001="JSDO: JSDO has multiple tables. Please use {1} at the table reference level.";b.msgs.jsdoMSG002="JSDO: Working record for '{1}' is undefined.";b.msgs.jsdoMSG003="JSDO: {1} function requires a function as a parameter.";b.msgs.jsdoMSG004="JSDO: Unable to find resource '{1}' in the catalog.";b.msgs.jsdoMSG005="JSDO: Data for table '{1}' was not specified in addRecords() call.";b.msgs.jsdoMSG006="JSDO: Data for JSDO was not specified in addRecords() call.";b.msgs.jsdoMSG007="JSDO: Test function in {1} must return a boolean.";b.msgs.jsdoMSG008="JSDO: Invalid keyFields parameter in addRecords() call.";b.msgs.jsdoMSG009="JSDO: KeyField '{1}' in addRecords() call was not found in the schema.";b.msgs.jsdoMSG010="JSDO: Field '{1}' in relationship was not found in the schema.";b.msgs.jsdoMSG011="UIHelper: JSDO has multiple tables. Please use {1} at the table reference level.";b.msgs.jsdoMSG012="UIHelper: Invalid {2} parameter in {1} call.";b.msgs.jsdoMSG020="JSDO: tableName parameter must be a string in addRecords() call.";b.msgs.jsdoMSG021="JSDO: addMode parameter must be specified in addRecords() call.";b.msgs.jsdoMSG022="JSDO: Invalid addMode specified in addRecords() call.";b.msgs.jsdoMSG023="JSDO: Duplicate found in addRecords() call using APPEND mode.";b.msgs.jsdoMSG024="{1}: Unexpected signature in call to {2} function.";b.msgs.jsdoMSG025="{1}: Invalid parameters in call to {2} function.";b.msgs.jsdoMSG026="JSDO: saveChanges requires CREATE, UPDATE and DELETE operations to be defined.";b.msgs.jsdoMSG030="JSDO: Invalid {1}, expected {2}.";b.msgs.jsdoMSG031="JSDO: Specified sort field name '{1}' was not found in the schema.";b.msgs.jsdoMSG032="JSDO: Before-image data already exists for record in addRecords() call.";b.msgs.jsdoMSG033="{1}: Invalid signature for {2}. {3}";b.msgs.jsdoMSG034="JSDO: In '{1}' function, JSON data is missing _id";b.msgs.jsdoMSG035="JSDO: In '{1}' function, before-image JSON data is missing prods:clientId";b.msgs.jsdoMSG036="JSDO: '{1}' can only be called for a dataset";b.msgs.jsdoMSG037="{1}: Event name must be provided for {2}.";b.msgs.jsdoMSG038="Too few arguments. There must be at least {1}.";b.msgs.jsdoMSG039="The name of the event is not a string.";b.msgs.jsdoMSG040="The event listener is not a function.";b.msgs.jsdoMSG041="The event listener scope is not an object.";b.msgs.jsdoMSG042="'{1}' is not a defined event for this object.";b.msgs.jsdoMSG043="{1}: A session object was requested to check the status of a Mobile Service named '{2}', but it has not loaded the definition of that service.";b.msgs.jsdoMSG044="JSDO: In '{1}' function, {2} is missing {3} property.";b.msgs.jsdoMSG100="JSDO: Unexpected HTTP response. Too many records.";b.msgs.jsdoMSG101="Network error while executing HTTP request.";b.msgs.jsdoMSG110="Catalog error: idProperty not specified for resource '{1}'. idProperty is required {2}.";b.msgs.jsdoMSG111="Catalog error: Schema '{1}' was not found in catalog.";b.msgs.jsdoMSG112="Catalog error: Output parameter '{1}' was not found for operation '{2}'.";b.msgs.jsdoMSG113="Catalog error: Found xType '{1}' for output parameter '{2}' for operation '{3}' but xType DATASET, TABLE or ARRAY was expected.";b.msgs.jsdoMSG114="JSDO: idProperty '{1}' is missing from '{2}' record.";b.msgs.jsdoMSG115="JSDO: Invalid option specified in {1}() call.";b.msgs.jsdoMSG116="JSDO: {1} parameter must be a string in {2} call.";b.msgs.jsdoMSG117="JSDO: Schema from storage area '{1}' does not match JSDO schema";b.msgs.jsdoMSG118="JSDO: Plugin '{1}' was not found.";b.msgs.jsdoMSG119="JSDO: A mappingType is expected when 'capabilities' is set. Please specify a plugin (ex: JFP).";b.msgs.jsdoMSG998="JSDO: JSON object in addRecords() must be DataSet or Temp-Table data.";b.getMsgText=function(r,o){var q=b.msgs[r],p;if(!q){throw new Error("Message text was not found by getMsgText()")}for(p=1;p<arguments.length;p+=1){q=q.replace(new RegExp("\\{"+p+"\\}","g"),arguments[p])}return q};progress.data._getMsgText=b.getMsgText;progress.data.PluginManager={};progress.data.PluginManager._plugins={};progress.data.PluginManager.addPlugin=function(n,o){if(progress.data.PluginManager._plugins[n]===undefined){progress.data.PluginManager._plugins[n]=o}else{throw new Error("A plugin named '"+n+"' is already registered.")}};progress.data.PluginManager.getPlugin=function(n){return progress.data.PluginManager._plugins[n]};progress.data.JSIndexEntry=function k(n){this.index=n};progress.data.JSTableRef=function c(o,n){this._jsdo=o;this._name=n;this._schema=null;this._primaryKeys=null;this._fields=null;this._processed={};this._visited=false;this.record=null;this._data=[];this._index={};this._hasEmptyBlocks=false;this._beforeImage={};this._added=[];this._changed={};this._deleted=[];this._createIndex=function(){var q,r,s,p;this._index={};this._hasEmptyBlocks=false;for(q=0;q<this._data.length;q+=1){r=this._data[q];if(!r){this._hasEmptyBlocks=true;continue}s=this._data[q]._id;if(!s){p=this._jsdo._resource.idProperty;if(typeof(p)=="string"){s=this._data[q][p];if(!s){throw new Error(b.getMsgText("jsdoMSG114",p,this._name))}s+=""}else{s=progress.data._getNextId()}this._data[q]._id=s}this._index[s]=new progress.data.JSIndexEntry(q)}this._needCompaction=false};this._compact=function(){var q=[],p,r;for(p=0;p<this._data.length;p+=1){r=this._data[p];if(r){q.push(r)}}this._data=q;this._createIndex()};this._loadBeforeImageData=function(x,s,v){var q=x[this._jsdo._dataSetName]["prods:before"],D={},t,u,p,K,r,y,z,B,A,F;if(q&&q[this._name]){if((Object.keys(this._beforeImage).length!==0)&&v&&(v.length!==0)){r={};for(y in this._beforeImage){z=this._findById(y,false);if(z){K=this._getKey(z.data,v);r[K]=z.data}}}for(F=0;F<q[this._name].length;F++){t=q[this._name][F];D[t["prods:id"]]=t;if(t["prods:rowState"]=="deleted"){K=undefined;if(v&&(v.length!==0)){K=this._getKey(t,v)}if(r){if(r[K]!==undefined){throw new Error(b.getMsgText("jsdoMSG032"))}}if((B===undefined)&&v&&(v.length!==0)){B={};A={};for(var E=0;E<this._data.length;E++){u=this._data[E];if(!u){continue}var J=this._getKey(u,v);B[J]=u}for(var E=0;E<this._deleted.length;E++){u=this._deleted[E].data;if(!u){continue}var J=this._getKey(u,v);A[J]=u}}if(K!==undefined){u=A[K];if(u!==undefined){continue}}if(K!==undefined){u=B[K];if(u!==undefined){var z=this._findById(u._id,false);if(z){z._remove(false)}t._id=u._id}}if(t._id===undefined){t._id=progress.data._getNextId()}var C={};this._jsdo._copyRecord(this._tableRef,t,C);this._jsdo._deleteProdsProperties(C);this._beforeImage[t._id]=C;var z=new progress.data.JSRecord(this,C);this._deleted.push(z)}}}var G=x[this._jsdo._dataSetName][this._name];if(G){for(var F=0;F<x[this._jsdo._dataSetName][this._name].length;F++){t=x[this._jsdo._dataSetName][this._name][F];p=undefined;if(s&&t["prods:id"]){p=s[t["prods:id"]]}switch(t["prods:rowState"]){case"created":if(p===undefined){p=t._id}if(p!==undefined){this._beforeImage[p]=null;this._added.push(p)}break;case"modified":var I=D[t["prods:id"]];if(I===undefined){I={}}if(p===undefined){p=t._id}if(p!==undefined){I._id=t._id;var C={};this._jsdo._copyRecord(this._tableRef,I,C);this._jsdo._deleteProdsProperties(C);this._beforeImage[p]=C;this._changed[p]=t;this._beforeImage[I._id]=C;this._changed[I._id]=t}break;case undefined:break;default:throw new Error(b.getMsgText("jsdoMSG030","rowState value in before-image data","'created' or 'modified'"))}}}var w=x[this._jsdo._dataSetName]["prods:errors"];if(w){for(var F=0;F<w[this._name].length;F++){var H=w[this._name][F];var p=s[H["prods:id"]];var z=this._findById(p,false);if(z){z.data._errorString=H["prods:error"]}}}D=null};this._clearData=function(){this._setRecord(null);this._data=[];this._index={};this._createIndex();this._beforeImage={};this._added=[];this._changed={};this._deleted=[]};this.hasData=function(){var q;if(this._jsdo._nestChildren){q=this._getDataWithNestedChildren(this._data)}else{q=this._getRelatedData()}if(this._hasEmptyBlocks){for(var p=0;p<q.length;p++){var r=q[p];if(!r){return true}}}return q.length!==0};this.getData=function(v){var q,t,p,r,u;if(this._needCompaction){this._compact()}if(v&&v.filter){throw new Error("Not implemented in current version")}else{if(this._jsdo._nestChildren){t=this._getDataWithNestedChildren(this._data)}else{t=this._getRelatedData()}}if(this._hasEmptyBlocks){p=0;r=[];for(q=0;q<t.length;q+=1){u=t[q];if(u){r.push(u)}else{p++}}if((p*100/this._data.length)>=a){this._needCompaction=true}t=r}else{if(v&&(v.orderBy||v.top)){r=[];for(q=0;q<t.length;q+=1){r.push(t[q])}t=r}}if(v&&(v.orderBy||v.top)){if(v.orderBy){sortFields=[];for(q=0;q<v.orderBy.length;q+=1){field=v.orderBy[q].field;if(v.orderBy[q].dir=="desc"){field+=":DESC"}sortFields.push(field)}var s=this._processSortFields(sortFields);if(s.sortFields&&s.sortFields.length>0){s.tableRef=this;t.sort(this._getCompareFn(s))}}if(v.top){if(typeof(v.skip)=="undefined"){v.skip=0}t=t.splice(v.skip,v.top)}}return t};this._recToDataObject=function(r,p){var v=[r];var u=v;if(typeof(p)=="undefined"){p=false}if(this._jsdo._dataSetName){u={};u[this._jsdo._dataSetName]={};u[this._jsdo._dataSetName][this._name]=v;if(p&&this._children.length>0){var q=this._findById(r._id,false);if(q){for(var t=0;t<this._children.length;t++){var s=this._children[t];u[this._jsdo._dataSetName][s]=this._jsdo._buffers[s]._getRelatedData(q)}}}}else{if(this._jsdo._dataProperty){u={};u[this._jsdo._dataProperty]=v}}return u};this._recFromDataObject=function(p){var q={};if(p){if(this._jsdo._dataSetName){if(p[this._jsdo._dataSetName]){q=p[this._jsdo._dataSetName][this._name]}}else{if(this._jsdo._dataProperty){if(p[this._jsdo._dataProperty]){q=p[this._jsdo._dataProperty]}}else{if(p.data){q=p.data}else{q=p}}}}return q instanceof Array?q[0]:q};this.getSchema=function(){return this._schema};this.setSchema=function(p){this._schema=p};this._getABLType=function(r){var p,q;q=this.getSchema();for(p=0;p<q.length;p++){if(q[p].name==r){return q[p].ablType}}return undefined};this.add=function(p){return this._add(p,true,true)};this._add=function(z,x,w){if(typeof(x)=="undefined"){x=true}if(typeof(w)=="undefined"){w=true}var t={};var q=this.getSchema();for(var s=0;s<q.length;s++){var A=q[s].name;if(q[s].type=="array"){t[A]=[];if(q[s].maxItems){for(var r=0;r<q[s].maxItems;r++){t[A][r]=q[s]["default"]}}}else{t[A]=this._jsdo._getDefaultValue(q[s])}}if(this._jsdo.useRelationships&&this._relationship&&this._parent){if(this._jsdo._buffers[this._parent].record){for(var r=0;r<this._relationship.length;r++){t[this._relationship[r].childFieldName]=this._jsdo._buffers[this._parent].record.data[this._relationship[r].parentFieldName]}}else{throw new Error(b.getMsgText("jsdoMSG002",this._parent))}}for(var y in z){t[y]=z[y]}var p;var C;if((C=this._jsdo._resource.idProperty)!==undefined){p=t[C]}if(!p){p=progress.data._getNextId()}else{p+=""}t._id=p;if(this.autoSort&&this._sortRecords&&(this._sortFn!==undefined||this._sortObject.sortFields!==undefined)){if(this._needsAutoSorting){this._data.push(t);this._sort()}else{for(var s=0;s<this._data.length;s++){if(this._data[s]===null){continue}var u=this._sortFn?this._sortFn(t,this._data[s]):this._compareFields(t,this._data[s]);if(u==-1){break}}this._data.splice(s,0,t)}this._createIndex()}else{this._data.push(t);this._index[t._id]=new progress.data.JSIndexEntry(this._data.length-1)}var B=new progress.data.JSRecord(this,t);if(w){this._setRecord(B,true)}if(x){this._beforeImage[t._id]=null;this._added.push(t._id)}return B};this._getRelatedData=function(p){var t=[];if(this._data.length===0){return t}if(typeof(p)=="undefined"){if(this._jsdo.useRelationships&&this._relationship&&this._parent){p=this._jsdo._buffers[this._parent].record;if(!p){throw new Error(b.getMsgText("jsdoMSG002",this._parent))}}}if(p){for(var s=0;s<this._data.length;s++){var u=this._data[s];if(!u){continue}var r=false;for(var q=0;q<this._relationship.length;q++){r=(p.data[this._relationship[q].parentFieldName]==this._data[s][this._relationship[q].childFieldName]);if(!r){break}}if(r){t.push(this._data[s])}}}else{t=this._data}return t};this._getDataWithNestedChildren=function(t){for(var u=0;u<t.length;u++){var p=t[u];if(this._children&&this._children.length>0){for(var s=0;s<this._children.length;s++){var w=this._jsdo._buffers[this._children[s]];if(w._isNested){for(var r=0;r<w._data.length;r++){var x=w._data[r];if(!x){continue}var v=false;for(var q=0;q<w._relationship.length;q++){v=(p[w._relationship[q].parentFieldName]==x[w._relationship[q].childFieldName]);if(!v){break}}if(v){if(!p[w._name]){p[w._name]=[]}p[w._name].push(x)}}if(w._hasNestedChild()){w._getDataWithNestedChildren(p[w._name])}}}}}return t};this._findFirst=function(){if(this._jsdo.useRelationships&&this._relationship&&this._parent){if(this._jsdo._buffers[this._parent].record){for(var r=0;r<this._data.length;r++){var u=this._data[r];if(!u){continue}var q=false;var t,s;for(var p=0;p<this._relationship.length;p++){t=this._relationship[p].parentFieldName;s=this._relationship[p].childFieldName;q=(this._jsdo._buffers[this._parent].record.data[t]==this._data[r][s]);if(!q){break}}if(q){return new progress.data.JSRecord(this,this._data[r])}}}}else{for(var r=0;r<this._data.length;r++){var u=this._data[r];if(!u){continue}return new progress.data.JSRecord(this,this._data[r])}}return undefined};this._setRecord=function(p,s){if(p){this.record=p}else{this.record=undefined}if(this._jsdo.useRelationships){s=((typeof(s)=="boolean")&&s);if(this._children&&this._children.length>0){for(var r=0;r<this._children.length;r++){var q=this._jsdo._buffers[this._children[r]];if(!s&&this.record&&q._relationship){q._setRecord(q._findFirst())}else{q._setRecord(undefined,s)}}}}if(this._jsdo._defaultTableRef){this._jsdo.record=this.record}};this.assign=function(p){if(this.record){return this.record.assign(p)}else{throw new Error(b.getMsgText("jsdoMSG002",this._name))}};this.remove=function(){if(this.record){return this.record._remove(true)}else{throw new Error(b.getMsgText("jsdoMSG002",this._name))}};this._remove=function(p){if(this.record){return this.record._remove(p)}else{throw new Error(b.getMsgText("jsdoMSG002",this._name))}};this.getId=function(){if(this.record){return this.record.data._id}else{return 0}};this.getErrorString=function(){if(this.record){return this.record.data._errorString}else{return 0}};this.findById=function(p){return this._findById(p,true)};this._findById=function(r,q){if(typeof(q)=="undefined"){q=true}if(r&&this._index[r]){var p=this._data[this._index[r].index];this.record=p?(new progress.data.JSRecord(this,p)):null;if(q){this._setRecord(this.record)}return this.record}if(q){this._setRecord(null)}return null};this.find=function(r){if(typeof(r)!="function"){throw new Error(b.getMsgText("jsdoMSG003","find()"))}var s=this._getRelatedData();for(var q=0;q<s.length;q++){var t=s[q];if(!t){continue}this._setRecord(new progress.data.JSRecord(this,s[q]));var p=r(this.record);if(typeof(p)!="boolean"){throw new Error(b.getMsgText("jsdoMSG007","find()"))}if(p){return this.record}}this._setRecord(null);return null};this.foreach=function(s){if(typeof(s)!="function"){throw new Error(b.getMsgText("jsdoMSG003","foreach()"))}var r=0;if(this._needCompaction){this._compact()}var t=this._getRelatedData();this._inforeach=true;for(var q=0;q<t.length;q++){var u=t[q];if(!u){r++;continue}this._setRecord(new progress.data.JSRecord(this,t[q]));var p=s(this.record);if((typeof(p)!="undefined")&&!p){break}}this._inforeach=false;if((r*100/this._data.length)>=a){this._needCompaction=true}};this._equalRecord=function(t,s,p){var w;var r=true;for(var q=0;q<p.length;q++){var x=p[q];var v=t[x];var u=s[x];if(!o[n].caseSensitive){w=o[n]._fields[x.toLowerCase()];if(w&&w.type=="string"){if(v!==undefined&&v!==null){v=v.toUpperCase()}if(u!==undefined&&u!==null){u=u.toUpperCase()}}}r=(v==u);if(!r){return false}}return true};this._getKey=function(p,t){var q={};for(var r=0;r<t.length;r++){var u=t[r];var s=p[u];if(!o[n].caseSensitive){field=o[n]._fields[u.toLowerCase()];if(field&&field.type=="string"){if(s!==undefined&&s!==null){s=s.toUpperCase()}}}q[u]=s}return JSON.stringify(q)};this._getCompareFn=function(p){if(typeof p=="function"){return function(r,q){if(r===null){return 1}if(q===null){return -1}var t=new progress.data.JSRecord(this,r);var s=new progress.data.JSRecord(this,q);return p(t,s)}}else{return function(v,u){var q=p.tableRef;var r=p.sortFields;if(!(r instanceof Array)){return 0}var t=p.sortAscending;if(v===null){return 1}if(u===null){return -1}var y;for(var s=0;s<r.length;s++){var z=r[s];var x=v[z];var w=u[z];if(!q.caseSensitive){y=q._fields[z.toLowerCase()];if(y&&y.type=="string"){if(x!==undefined&&x!==null){x=x.toUpperCase()}if(w!==undefined&&w!==null){w=w.toUpperCase()}}}if(x>w||(x===undefined||x===null)){return t[s]?1:-1}else{if(x<w||(w===undefined&&w===null)){return t[s]?-1:1}}}return 0}}};this._sortObject={};this._sortObject.tableRef=this;this._sortObject.sortFields=undefined;this._sortObject.sortAscending=undefined;this._compareFields=this._getCompareFn(this._sortObject);this._sortRecords=true;this._needsAutoSorting=false;this._sortFn=undefined;if((typeof Object.defineProperty)=="function"){this._autoSort=true;Object.defineProperty(this,"autoSort",{get:function(){return this._autoSort},set:function(p){if(p){this._autoSort=true;if(this._sortFn||this._sortObject.sortFields){this._sort();this._createIndex()}}else{this._autoSort=false}},enumerable:true,writeable:true});this._caseSensitive=false;Object.defineProperty(this,"caseSensitive",{get:function(){return this._caseSensitive},set:function(p){if(p){this._caseSensitive=true}else{this._caseSensitive=false}if(this.autoSort&&(this._sortObject.sortFields&&!this._sortFn)){this._sort();this._createIndex()}},enumerable:true,writeable:true})}else{this.autoSort=true;this.caseSensitive=false}this._processSortFields=function(r){var t={};if(r instanceof Array){t.sortFields=r;t.sortAscending=[];t.fields={};for(var q=0;q<t.sortFields.length;q++){var p;var v;var u;if(typeof(t.sortFields[q])!="string"){throw new Error(b.getMsgText("jsdoMSG030","sort field name","string element"))}if((p=t.sortFields[q].indexOf(":"))!=-1){v=t.sortFields[q].substring(0,p);var s=t.sortFields[q].substring(p+1);switch(s.toUpperCase()){case"ASCENDING":case"ASC":t.sortAscending[q]=true;break;case"DESCENDING":case"DESC":t.sortAscending[q]=false;break;default:throw new Error(b.getMsgText("jsdoMSG030","sort order '"+t.sortFields[q].substring(p+1)+"'","ASCENDING or DESCENDING"))}}else{v=t.sortFields[q];t.sortAscending[q]=true}if(v!="_id"&&this._fields){u=this._fields[v.toLowerCase()];if(u){if(u.type=="array"){throw new Error(b.getMsgText("jsdoMSG030","data type found in sort","scalar field"))}v=u.name}else{throw new Error(b.getMsgText("jsdoMSG031",v))}}t.sortFields[q]=v;t.fields[v]=v}}else{t.sortFields=undefined;t.sortAscending=undefined;t.fields=undefined}return t};this.setSortFields=function(p){if(p===undefined||p===null){this._sortObject.sortFields=undefined;this._sortObject.sortAscending=undefined}else{if(p instanceof Array){var q=this._processSortFields(p);this._sortObject.sortFields=q.sortFields;this._sortObject.sortAscending=q.sortAscending;this._sortObject.fields=q.fields;if(this.autoSort){this._sort();this._createIndex()}}else{throw new Error(b.getMsgText("jsdoMSG024","JSDO","setSortFields()"))}}};this.setSortFn=function(p){if(p&&typeof(p)!="function"){throw new Error(b.getMsgText("jsdoMSG030","parameter in setSortFn()","function parameter"))}this._sortFn=p?this._getCompareFn(p):undefined;if(this.autoSort){this._sort();this._createIndex()}};this.sort=function(p){if(p===undefined||p===null){throw new Error(b.getMsgText("jsdoMSG025","JSDO","sort()"))}if(arguments.length!==1||(!(p instanceof Array)&&typeof(p)!="function")){throw new Error(b.getMsgText("jsdoMSG024","JSDO","sort()"))}if(p instanceof Array){var q=this._processSortFields(p);if(q.sortFields&&q.sortFields.length>0){this._sort(q)}}else{this._sort(p)}this._createIndex()};this._sort=function(p){if(arguments.length===0&&(!this.autoSort||(this._sortFn===undefined&&this._sortObject.sortFields===undefined))){return}if(arguments.length===0){if(this._sortFn){this._data.sort(this._sortFn)}else{this._data.sort(this._compareFields)}this._needsAutoSorting=false}else{if(typeof(p)=="function"){this._data.sort(this._getCompareFn(p))}else{p.tableRef=this;this._data.sort(this._getCompareFn(p))}if(this.autoSort){this._needsAutoSorting=true}}};this.addRecords=function(r,q,t,s,p){this._jsdo._addRecords(this._name,r,q,t,s,p)};this.acceptChanges=function(){var q=this;for(var r in q._beforeImage){if(q._beforeImage[r]===null){var p=q._findById(r,false);if(p!==null){q._jsdo._deleteProdsProperties(p.data,true)}}else{if(this._changed[r]!==undefined){var p=this._findById(r,false);if(p!==null){q._jsdo._deleteProdsProperties(p.data,true)}}}}q._processed={};q._added=[];q._changed={};q._deleted=[];q._beforeImage={}};this.rejectChanges=function(){for(var q in this._beforeImage){if(this._beforeImage[q]===null){this._jsdo._undoCreate(this,q)}else{if(this._changed[q]!==undefined){this._jsdo._undoUpdate(this,q,true)}else{this._jsdo._undoDelete(this,q,true)}}}var p=this;p._processed={};p._added=[];p._changed={};p._deleted=[]};this.hasChanges=function(){return(Object.keys(this._beforeImage).length!==0)};this.getChanges=function(){var p=[];for(var r in this._beforeImage){var q={rowState:"",record:null};if(this._beforeImage[r]===null){q.rowState=g[progress.data.JSDO._OP_CREATE];q.record=this._findById(r,false)}else{if(this._changed[r]!==undefined){q.rowState=g[progress.data.JSDO._OP_UPDATE];q.record=this._findById(r,false)}else{q.rowState=g[progress.data.JSDO._OP_DELETE];q.record=new progress.data.JSRecord(this,this._beforeImage[r])}}p.push(q)}return p};this._applyChanges=function(){for(var t in this._beforeImage){if(this._beforeImage[t]===null){var p=this._findById(t,false);if(p!==null){if(p.data._errorString!==undefined){this._jsdo._undoCreate(this,t)}else{p.acceptRowChanges()}}else{var r=false;for(var q=0;q<this._deleted.length;q++){r=(this._deleted[q].data._id==t);if(r){break}}if(!r){throw new Error(b.getMsgText("jsdoMSG000","Created record appears to be deleted without a delete operation."))}}}else{if(this._changed[t]!==undefined){var p=this._findById(t,false);if(p!==null){if(p.data._errorString!==undefined){this._jsdo._undoUpdate(this,t)}else{p.acceptRowChanges()}}else{if(this._beforeImage[t]._errorString!==undefined){this._jsdo._undoDelete(this,t)}else{var r=false;for(var q=0;q<this._deleted.length;q++){r=(this._deleted[q].data._id==t);if(r){break}}if(!r){throw new Error(b.getMsgText("jsdoMSG000","Updated record appears to be deleted without a delete operation."))}}}}else{if(this._beforeImage[t]._errorString!==undefined){this._jsdo._undoDelete(this,t)}}}}var s=this;s._processed={};s._added=[];s._changed={};s._deleted=[];s._beforeImage={}};this.acceptRowChanges=function(){if(this.record){return this.record.acceptRowChanges()}throw new Error(b.getMsgText("jsdoMSG002",this._name))};this.rejectRowChanges=function(){if(this.record){return this.record.rejectRowChanges()}throw new Error(b.getMsgText("jsdoMSG002",this._name))};this._hasNestedChild=function(){var q=false;var r;if(this._children.length>0){for(var p=0;p<this._children.length;p++){r=this._jsdo._buffers[this._children[p]];if(r._isNested){q=true;break}}}return q}};progress.data.JSRecord=function d(o,n){this._tableRef=o;this.data=n;this.getId=function(){return this.data._id?this.data._id:null};this.getErrorString=function(){return this.data._errorString};this._saveBeforeImageUpdate=function(){if(this._tableRef._beforeImage[this.data._id]===undefined){var p={};this._tableRef._jsdo._copyRecord(this._tableRef,this.data,p);this._tableRef._beforeImage[this.data._id]=p}if(this._tableRef._changed[this.data._id]===undefined){this._tableRef._changed[this.data._id]=this.data}};this._sortRecord=function(p){var s=this._tableRef._index[this.data._id].index;var q=this._tableRef._data[s];if(this._tableRef.autoSort&&this._tableRef._sortRecords&&(this._tableRef._sortFn!==undefined||this._tableRef._sortObject.sortFields!==undefined)){if(this._tableRef._sortObject.fields){if(typeof p=="string"){if(this._tableRef._sortObject.fields[p]===undefined){return}}else{if(p instanceof Array){var u=false;for(var t=0;t<p.length;t++){if(this._tableRef._sortObject.fields[p[t]]!==undefined){u=true;break}}if(!u){return}}}}if(this._tableRef._needsAutoSorting){this._tableRef._sort();this._tableRef._createIndex()}else{for(var t=0;t<this._tableRef._data.length;t++){if(this._tableRef._data[t]===null){continue}if(t==s){continue}var r=this._tableRef._sortFn?this._tableRef._sortFn(q,this._tableRef._data[t]):this._tableRef._compareFields(q,this._tableRef._data[t]);if(r==-1){break}}if(t>s){t--}if(t!=s){this._tableRef._data.splice(s,1);this._tableRef._data.splice(t,0,q);this._tableRef._createIndex()}}}};this.assign=function(p){if(p===undefined){throw new Error(b.getMsgText("jsdoMSG024","JSDO","assign()"))}this._saveBeforeImageUpdate();var t;var s;var r=this._tableRef.getSchema();if(p){for(var q=0;q<r.length;q++){t=r[q].name;s=p[t];if(typeof s!="undefined"){if(typeof s=="string"&&r[q].type!="string"){s=this._tableRef._jsdo._convertType(s,r[q].type,r[q].items?r[q].items.type:null)}this.data[t]=s}}this._sortRecord()}return true};this.remove=function(){return this._remove(true)};this._remove=function(s){if(typeof(s)=="undefined"){s=true}var r=this._tableRef._index[this.data._id].index;var q=this._tableRef._findById(this.data._id,false);if(s){var p=this._tableRef._beforeImage[this.data._id];if(p===undefined){this.data._index=r;this._tableRef._beforeImage[this.data._id]=this.data}else{if(p){p._index=r}}this._tableRef._deleted.push(q)}this._tableRef._data[r]=null;this._tableRef._hasEmptyBlocks=true;delete this._tableRef._index[this.data._id];this._tableRef._setRecord(null);return true};this.acceptRowChanges=function(){var q=this.data._id;if(this._tableRef._beforeImage[q]!==undefined){if(this._tableRef._beforeImage[q]===null){for(var p=0;p<this._tableRef._added.length;p++){if(this._tableRef._added[p]==q){this._tableRef._added.splice(p,1);break}}this._tableRef._jsdo._deleteProdsProperties(this.data,true)}else{if(this._tableRef._changed[q]!==undefined){delete this._tableRef._changed[q];this._tableRef._jsdo._deleteProdsProperties(this.data,true)}else{for(var p=0;p<this._tableRef._deleted.length;p++){if(this._tableRef._deleted[p].data._id==q){this._tableRef._deleted.splice(p,1);break}}}}delete o._beforeImage[q]}};this.rejectRowChanges=function(){var q=this.data._id;if(this._tableRef._beforeImage[q]!==undefined){if(this._tableRef._beforeImage[q]===null){this._tableRef._jsdo._undoCreate(this._tableRef,q);for(var p=0;p<this._tableRef._added.length;p++){if(this._tableRef._added[p]==q){this._tableRef._added.splice(p,1);break}}}else{if(this._tableRef._changed[q]!==undefined){this._tableRef._jsdo._undoUpdate(this._tableRef,q,true);delete this._tableRef._changed[q]}else{this._tableRef._jsdo._undoDelete(this._tableRef,q,true);for(var p=0;p<this._tableRef._deleted.length;p++){if(this._tableRef._deleted[p].data._id==q){this._tableRef._deleted.splice(p,1);break}}}}delete o._beforeImage[q]}}};progress.data.JSDO=function j(K,y){if(typeof progress.data.Session=="undefined"){throw new Error("ERROR: You must include progress.session.js")}this._defineProperty=function(v,P){Object.defineProperty(this._buffers[v],P,{get:function O(){if(this.record){return this.record.data[P]}else{return null}},set:function(Q){if(this.record){this.record._saveBeforeImageUpdate();this.record.data[P]=Q;this.record._sortRecord(P)}},enumerable:true,writeable:true})};this._buffers={};this._numBuffers=0;this._defaultTableRef=null;this._async=true;this._dataProperty=null;this._dataSetName=null;this.operations=[];this.useRelationships=true;this._session=null;this._needCompaction=false;this._hasCUDOperations=false;this._hasSubmitOperation=false;this._useSubmit=false;this.autoApplyChanges=true;this._lastErrors=[];this._localStorage=null;var E=false;if(!arguments[0]){throw new Error("JSDO: Parameters are required in constructor.")}if(typeof(arguments[0])=="string"){this.name=arguments[0]}else{if(typeof(arguments[0])=="object"){var q=arguments[0];for(var z in q){switch(z){case"autoFill":E=q[z];break;case"events":this._events={};for(var w in q[z]){this._events[w.toLowerCase()]=q[z][w]}break;case"dataProperty":this._dataProperty=q[z];break;default:this[z]=q[z]}}}}if((!this.name)){throw new Error("JSDO: JSDO constructor is missing the value for 'name'")}if(this._events){if((typeof this._events)!=="object"){throw new Error("JSDO: JSDO constructor event object is not defined as an object")}for(var s in this._events){var C=this._events[s];if(!(C instanceof Array)){throw new Error("JSDO: JSDO constructor event object for "+s+" must be an array")}C.forEach(function(v){if((typeof v)!=="object"){throw new Error("JSDO: JSDO constuctor event object for "+s+" is not defined as an object")}if((typeof v.fn)!=="function"){throw new Error("JSDO: JSDO event listener for "+s+" is not a function.")}if(v.scope&&(typeof v.scope)!=="object"){throw new Error("JSDO: JSDO event listener scope for "+s+" is not an object.")}})}}if(this.name){this._resource=progress.data.ServicesManager.getResource(this.name);if(this._resource){if(!this.url){this.url=this._resource.url}if(!this._dataSetName&&this._resource._dataSetName){this._dataSetName=this._resource._dataSetName;if(this._resource.dataProperty){var H=this[this._resource.dataProperty]=new progress.data.JSTableRef(this,this._resource.dataProperty);this._buffers[this._resource.dataProperty]=H}else{for(var t in this._resource.fields){var H=this[t]=new progress.data.JSTableRef(this,t);this._buffers[t]=H}}}if(!this._dataProperty&&this._resource.dataProperty){this._dataProperty=this._resource.dataProperty}if(!this._dataSetName){var t=this._dataProperty?this._dataProperty:"";this._buffers[t]=new progress.data.JSTableRef(this,t);if(t){this[t]=this._buffers[t]}}for(var D in this._resource.fn){this[D]=this._resource.fn[D]["function"]}this._hasCUDOperations=this._resource.generic.create!==undefined||this._resource.generic.update!==undefined||this._resource.generic["delete"]!==undefined;this._hasSubmitOperation=this._resource.generic.submit!==undefined;if(!this._session){var x=progress.data.ServicesManager.getService(this._resource.service.name);this._session=x._session;this._session._pushJSDOs(this)}}else{throw new Error(b.getMsgText("jsdoMSG004",this.name))}}else{this._buffers[""]=new progress.data.JSTableRef(this,"")}if(!this._session){throw new Error("JSDO: Unable to get user session for resource '"+this.name+"'")}for(var M in this._buffers){this._buffers[M]._parent=null;this._buffers[M]._children=[];this._buffers[M]._relationship=null;this._buffers[M]._isNested=false;if(!this._defaultTableRef){this._defaultTableRef=this._buffers[M]}this._numBuffers++}if(this._numBuffers!=1){this._defaultTableRef=null}else{this.record=null}if((typeof Object.defineProperty)=="function"){this._caseSensitive=false;Object.defineProperty(this,"caseSensitive",{get:function(){return this._caseSensitive},set:function(O){this._caseSensitive=O?true:false;for(var v in this._buffers){this._buffers[v].caseSensitive=this._caseSensitive}},enumerable:true,writeable:true});this._autoSort=true;Object.defineProperty(this,"autoSort",{get:function(){return this._autoSort},set:function(O){this._autoSort=O?true:false;for(var v in this._buffers){this._buffers[v].autoSort=this._autoSort}},enumerable:true,writeable:true})}if(this._resource&&this._resource.fields){for(var M in this._buffers){this._buffers[M]._schema=this._resource.fields[M];this._buffers[M]._primaryKeys=this._resource.primaryKeys[M];if(this._buffers[M]._schema&&(typeof Object.defineProperty)=="function"){for(var J=0;J<this._buffers[M]._schema.length;J++){var r=this._buffers[M]._schema[J].name;if(typeof(this._buffers[M][r])=="undefined"){this._defineProperty(M,r)}}}this._buffers[M]._fields={};var G=this._buffers[M]._schema;for(var J=0;J<G.length;J++){this._buffers[M]._fields[G[J].name.toLowerCase()]=G[J]}}if(this._defaultTableRef&&!this._defaultTableRef._schema&&this._resource.fields[""]){this._defaultTableRef._schema=this._resource.fields[""]}}else{if(this._defaultTableRef){this._defaultTableRef._schema=[]}}if(this._numBuffers>1){for(var M in this._buffers){var G=[];var B=false;for(var J=0;J<this._buffers[M]._schema.length;J++){var p=this._buffers[M]._schema[J];if(p.items&&p.type=="array"&&p.items.$ref){if(this._buffers[p.name]){B=true;this._buffers[p.name]._isNested=true}}else{G.push(p)}}if(B){this._buffers[M]._schema=G}}}if(this._resource&&this._resource.relations){for(var J=0;J<this._resource.relations.length;J++){var o=this._resource.relations[J];if(o.childName&&o.parentName){if(o.relationFields instanceof Array){for(var I=0;I<o.relationFields.length;I++){var r;var p;if(this._buffers[o.parentName]._fields){r=o.relationFields[I].parentFieldName;p=this._buffers[o.parentName]._fields[r.toLowerCase()];if(p){o.relationFields[I].parentFieldName=p.name}else{throw new Error(b.getMsgText("jsdoMSG010",r))}}if(this._buffers[o.childName]._fields){r=o.relationFields[I].childFieldName;p=this._buffers[o.childName]._fields[r.toLowerCase()];if(p){o.relationFields[I].childFieldName=p.name}else{throw new Error(b.getMsgText("jsdoMSG010",r))}}}}this._buffers[o.childName]._parent=o.parentName;this._buffers[o.childName]._relationship=o.relationFields;this._buffers[o.parentName]._children.push(o.childName)}}}this._getDefaultValue=function(Q){var O,P,v,R;if((Q.type==="string")&&Q.format&&(Q.format.indexOf("date")!==-1)&&(Q["default"])){switch(Q["default"].toUpperCase()){case"NOW":O=new Date().toISOString();break;case"TODAY":P=new Date();v=String((P.getMonth()+1));if(v.length===1){v="0"+v}R=String((P.getDate()));if(R.length===1){R="0"+R}O=P.getFullYear()+"-"+v+"-"+R;break;default:O=Q["default"]}}else{O=Q["default"]}return O};this.isDataSet=function(){return this._dataSetName?true:false};this._invokeComplete=function(v,P,O){if(O.async&&O.fnName){v.trigger("afterInvoke",O.fnName,v,P,O)}if(O.deferred){if(P){O.deferred.resolve(O.fnName,v,P,O)}else{O.deferred.reject(O.fnName,v,P,O)}}};this._invokeSuccess=function(){};this._invokeError=function(){};this._httpRequest=function(T,U,O,R,Q){if(!T){T=new XMLHttpRequest();T.onCompleteFn=this._invokeComplete;T.onSuccessFn=this._invokeSuccess;T.onErrorFn=this._invokeError;T.onreadystatechange=this.onReadyStateChangeGeneric;if(Q.async&&Q.fnName){this.trigger("beforeInvoke",Q.fnName,this,Q)}if(R){if(this._resource&&this._resource.service){var P=this._resource.service.useRequest;if(this._resource.service.settings&&this._resource.service.settings.useRequest!==undefined){P=this._resource.service.settings.useRequest}if(P){R={request:R}}}}}T.request=Q;T.jsdo=this;Q.jsdo=this;Q.xhr=T;this._session._openRequest(T,U,O,Q.async);var v=null;if(R){T.setRequestHeader("Content-Type","application/json; charset=utf-8");v=JSON.stringify(R)}try{T.send(v)}catch(S){Q.success=false;Q.exception=S;T.jsdo._session._checkServiceResponse(T,Q.success,Q)}return Q};this._getDataObject=function(){var P={};if(this._dataSetName){P[this._dataSetName]={};var O=this.useRelationships;try{this.useRelationships=false;for(var v in this._buffers){P[this._dataSetName][v]=this._buffers[v].getData()}}finally{this.useRelationships=O}}else{if(this._dataProperty){P[this._dataProperty]=this.getData()}else{return this.getData()}}return P};this._getDataObjectAsNested=function(){var P={};if(this._dataSetName){P[this._dataSetName]={};try{for(var v in this._buffers){var R=this._buffers[v];if(R._isNested){continue}this._nestChildren=false;if(R._children.length>0){for(var O=0;O<R._children.length;O++){var Q=this._buffers[R._children[O]];if(Q._isNested){this._nestChildren=true;break}}}P[this._dataSetName][v]=this._buffers[v].getData()}}catch(S){throw new Error(b.getMsgText("jsdoMSG000",S.message))}finally{this._nestChildren=false}}else{if(this._dataProperty){P[this._dataProperty]=this.getData()}else{return this.getData()}}return P};this._unnestData=function(){if(this._dataSetName){var Q;var S;var R;for(var O in this._buffers){S=this._buffers[O];if(S._hasNestedChild()){for(var P=0;P<S._data.length;P++){Q=S._data[P];for(var v=0;v<S._children.length;v++){R=this._buffers[S._children[v]];if(Q[R._name]){delete Q[R._name]}}}}}}};this._recToDataObject=function(O,v){if(this._defaultTableRef){return this._defaultTableRef._recToDataObject(O,v)}throw new Error(b.getMsgText("jsdoMSG001","_recToDataObject()"))};this._recFromDataObject=function(v){if(this._defaultTableRef){return this._defaultTableRef._recFromDataObject(v)}throw new Error(b.getMsgText("jsdoMSG001","_recFromDataObject()"))};this.add=function(v){if(this._defaultTableRef){return this._defaultTableRef.add(v)}throw new Error(b.getMsgText("jsdoMSG001","add()"))};this.hasData=function(){for(var v in this._buffers){if(this._buffers[this._buffers[v]._name].hasData()){return true}}return false};this.getData=function(v){if(this._defaultTableRef){return this._defaultTableRef.getData(v)}throw new Error(b.getMsgText("jsdoMSG001","getData()"))};this.getSchema=function(){if(this._defaultTableRef){return this._defaultTableRef.getSchema()}throw new Error(b.getMsgText("jsdoMSG001","getSchema()"))};this.findById=function(v){if(this._defaultTableRef){return this._defaultTableRef.findById(v)}throw new Error(b.getMsgText("jsdoMSG001","findById()"))};this._convertType=function(S,P,U){if((typeof S!="string")||(P===null)){return S}var v=S;try{if(P=="array"){var v=[];S=S.slice(1,S.length-1);var R=S.split(",");var Q=(U&&(U!="string"));for(var O=0;O<R.length;O++){v[O]=Q?this._convertType(R[O],U,null):R[O]}}else{if(P=="integer"){v=parseInt(S)}else{if(P=="number"){v=parseFloat(S)}else{v=S}}}}catch(T){throw new Error(b.getMsgText("jsdoMSG000","Error converting string to native type: "+T.message))}return v};this.assign=function(v){if(this._defaultTableRef){return this._defaultTableRef.assign(v)}else{throw new Error(b.getMsgText("jsdoMSG001","assign()"))}};this.remove=function(){if(this._defaultTableRef){return this._defaultTableRef.remove()}else{throw new Error(b.getMsgText("jsdoMSG001","remove()"))}};this.getId=function(){if(this._defaultTableRef){return this._defaultTableRef.getId()}throw new Error(b.getMsgText("jsdoMSG001","getId()"))};this.getErrorString=function(){if(this._defaultTableRef){return this._defaultTableRef.getErrorString()}throw new Error(b.getMsgText("jsdoMSG001","getErrorString()"))};this.find=function(v){if(this._defaultTableRef){return this._defaultTableRef.find(v)}throw new Error(b.getMsgText("jsdoMSG001","find()"))};this.foreach=function(v){if(this._defaultTableRef){return this._defaultTableRef.foreach(v)}throw new Error(b.getMsgText("jsdoMSG001","foreach()"))};this.setSortFields=function(v){if(this._defaultTableRef){return this._defaultTableRef.setSortFields(v)}throw new Error(b.getMsgText("jsdoMSG001","setSortFields()"))};this.setSortFn=function(v){if(this._defaultTableRef){return this._defaultTableRef.setSortFn(v)}throw new Error(b.getMsgText("jsdoMSG001","setSortFn()"))};this.sort=function(v){if(this._defaultTableRef){return this._defaultTableRef.sort(v)}throw new Error(b.getMsgText("jsdoMSG001","sort()"))};this.fill=function(){var P,U,O,v;this._lastErrors=[];if(arguments.length!==0){if(typeof(arguments[0])=="function"){throw new Error(b.getMsgText("jsdoMSG024","JSDO","fill()"))}var Q;if(arguments[0]===null||arguments[0]===undefined){Q=""}else{if(typeof(arguments[0])=="string"){Q=arguments[0];P={filter:Q}}else{if(typeof(arguments[0])=="object"){O=this.getMethodProperties("read");if(O&&O.mappingType){v=progress.data.PluginManager.getPlugin(O.mappingType);if(!v){throw new Error(b.getMsgText("jsdoMSG118",O.mappingType))}if(typeof(v.requestMapping)==="function"){P=v.requestMapping(this,arguments[0],{operation:"read"})}else{P=arguments[0]}}else{if(O.capabilities){throw new Error(b.getMsgText("jsdoMSG119"))}P=arguments[0]}}else{throw new Error(b.getMsgText("jsdoMSG025","JSDO","fill()"))}}}}else{P=null}var T=new XMLHttpRequest();var R={xhr:T,jsdo:this,objParam:P};T.request=R;T.jsdo=this;T.onSuccessFn=this._fillSuccess;T.onErrorFn=this._fillError;T.onCompleteFn=this._fillComplete;T.onreadystatechange=this.onReadyStateChangeGeneric;this.trigger("beforeFill",this,R);if(this._resource){if(typeof(this._resource.generic.read)=="function"){T.objParam=P;this._resource.generic.read(T,this._async);if(T.request.deferred){U=T.request.deferred.promise()}}else{throw new Error("JSDO: READ operation is not defined.")}}else{this._session._openRequest(T,"GET",this.url,this._async);try{T.send(null)}catch(S){R.exception=S;T.jsdo._session._checkServiceResponse(T,R.success,R)}}return U};this._clearData=function(){for(var v in this._buffers){this._buffers[v]._clearData()}};this._execGenericOperation=function(v,O,P,R,Q,U){var S=new XMLHttpRequest();P.xhr=S;P.jsdo=this;P.objParam=O;P.operation=v;S.jsdo=this;S.onCompleteFn=R;S.onSuccessFn=Q;S.onErrorFn=U;S.onreadystatechange=this.onReadyStateChangeGeneric;S.request=P;var T;switch(v){case progress.data.JSDO._OP_READ:case progress.data.JSDO._OP_CREATE:case progress.data.JSDO._OP_UPDATE:case progress.data.JSDO._OP_DELETE:case progress.data.JSDO._OP_SUBMIT:T=m[v];break;default:throw new Error("JSDO: Unexpected operation "+v+" in HTTP request.")}if(this._resource){if(typeof(this._resource.generic[T])=="function"){S.objParam=O;this._resource.generic[T](S,this._async)}else{throw new Error("JSDO: "+T.toUpperCase()+" operation is not defined.")}}};this._undefWorkingRecord=function(){for(var v in this._buffers){this._buffers[v]._setRecord(null)}};this.saveChanges=function(v){var P;this._lastErrors=[];if(v===undefined){v=false}else{if(typeof(v)!="boolean"){throw new Error(b.getMsgText("jsdoMSG025","JSDO","saveChanges()"))}}this._useSubmit=v;if(!this._hasCUDOperations){throw new Error(b.getMsgText("jsdoMSG026"))}var O={jsdo:this};this.trigger("beforeSaveChanges",this,O);if(v){P=this._syncDataSetForSubmit(O)}else{if(this._dataSetName){P=this._syncDataSetForCUD()}else{P=this._syncSingleTable()}}return P};this.invoke=function(O,v){var P=this[O](v);if(P.deferred){return P.deferred.promise()}return undefined};this._syncTableRef=function(S,R,V){if(R._visited){return}R._visited=true;if(!V){V={operations:[]}}else{if(!V.operations){V.operations=[]}}switch(S){case progress.data.JSDO._OP_CREATE:for(var U=0;U<R._added.length;U++){var O=R._added[U];var ab=R._findById(O,false);if(!ab){continue}if(R._processed[O]){continue}R._processed[O]=ab.data;var X;if(this.isDataSet()){X={};if(this._useBeforeImage("create")){X[this._dataSetName]={};var Z=X[this._dataSetName];Z["prods:hasChanges"]=true;Z[R._name]=[];var Q={};Q["prods:rowState"]="created";Q["prods:clientId"]=ab.data._id;R._jsdo._copyRecord(R,ab.data,Q);delete Q._id;Z[R._name].push(Q)}else{X[R._name]=[];X[R._name].push(ab.data)}}else{X=ab.data}var T={operation:S,batch:V,jsrecord:ab,jsdo:this};V.operations.push(T);ab._tableRef.trigger("beforeCreate",this,ab,T);this.trigger("beforeCreate",this,ab,T);this._execGenericOperation(progress.data.JSDO._OP_CREATE,X,T,this._createComplete,this._createSuccess,this._createError)}break;case progress.data.JSDO._OP_UPDATE:for(var O in R._changed){var ab=R._findById(O,false);if(!ab){continue}if(R._processed[O]){continue}R._processed[O]=ab.data;var X={};var P={};var W=false;if(this.isDataSet()){if(this._useBeforeImage("update")){W=true;X[this._dataSetName]={};var Z=X[this._dataSetName];Z["prods:hasChanges"]=true;Z[R._name]=[];var Q={};Q["prods:id"]=ab.data._id;Q["prods:rowState"]="modified";Q["prods:clientId"]=ab.data._id;R._jsdo._copyRecord(R,ab.data,Q);delete Q._id;Z[R._name].push(Q);Z["prods:before"]={};var aa=Z["prods:before"];aa[R._name]=[];var Y={};Y["prods:id"]=ab.data._id;R._jsdo._copyRecord(R,R._beforeImage[ab.data._id],Y);delete Y._id;aa[R._name].push(Y)}}if(!W){if(this._resource.service&&this._resource.service.settings&&this._resource.service.settings.sendOnlyChanges){R._jsdo._copyRecord(R,ab.data,P,R._beforeImage[ab.data._id]);if(this._resource.idProperty){P[this._resource.idProperty]=ab.data[this._resource.idProperty]}else{throw new Error(b.getMsgText("jsdoMSG110",this._resource.name," for sendOnlyChanges property"))}}else{P=ab.data}if(this.isDataSet()){X[R._name]=[];X[R._name].push(P)}else{P=ab.data;X=P}}var T={jsrecord:ab,operation:S,batch:V,jsdo:this};V.operations.push(T);ab._tableRef.trigger("beforeUpdate",this,ab,T);this.trigger("beforeUpdate",this,ab,T);this._execGenericOperation(progress.data.JSDO._OP_UPDATE,X,T,this._updateComplete,this._updateSuccess,this._updateError)}break}for(var U=0;U<R._children.length;U++){var v=R._children[U];this._syncTableRef(S,this._buffers[v],V)}if(S==progress.data.JSDO._OP_DELETE){for(var U=0;U<R._deleted.length;U++){var O=R._deleted[U]._id;var ab=R._deleted[U];if(!ab){continue}R._processed[O]=ab.data;var X={};var P={};var W=false;if(this.isDataSet()){if(this._useBeforeImage("delete")){W=true;X[this._dataSetName]={};var Z=X[this._dataSetName];Z["prods:hasChanges"]=true;Z["prods:before"]={};var aa=Z["prods:before"];aa[R._name]=[];var Q=ab.data;var Y={};Y["prods:rowState"]="deleted";Y["prods:clientId"]=ab.data._id;R._jsdo._copyRecord(R,R._beforeImage[Q._id],Y);aa[R._name].push(Y)}}if(!W){if(this._resource.service&&this._resource.service.settings&&this._resource.service.settings.sendOnlyChanges){if(this._resource.idProperty){P[this._resource.idProperty]=ab.data[this._resource.idProperty]}else{throw new Error(b.getMsgText("jsdoMSG110",this._resource.name," for sendOnlyChanges property"))}}else{P=ab.data}if(this.isDataSet()){X[R._name]=[];X[R._name].push(P)}else{P=ab.data;X=P}}var T={batch:V,jsrecord:ab,operation:S,jsdo:this};V.operations.push(T);ab._tableRef.trigger("beforeDelete",this,ab,T);this.trigger("beforeDelete",this,ab,T);this._execGenericOperation(progress.data.JSDO._OP_DELETE,X,T,this._deleteComplete,this._deleteSuccess,this._deleteError)}}};this._useBeforeImage=function(O){for(var v=0;v<this._resource.operations.length;v++){if(this._resource.operations[v].type==O){return this._resource.operations[v].useBeforeImage}}return false};this._syncDataSetForCUD=function(){var P={operations:[]},v,T;if(typeof($)=="function"&&typeof($.Deferred)=="function"){v=$.Deferred();T=v.promise();P.deferred=v}for(var O in this._buffers){this._buffers[O]._visited=false}for(var O in this._buffers){var R=this._buffers[O];this._syncTableRef(progress.data.JSDO._OP_DELETE,R,P)}for(var O in this._buffers){this._buffers[O]._visited=false}for(var O in this._buffers){var R=this._buffers[O];this._syncTableRef(progress.data.JSDO._OP_CREATE,R,P)}for(var O in this._buffers){this._buffers[O]._visited=false}for(var O in this._buffers){var R=this._buffers[O];this._syncTableRef(progress.data.JSDO._OP_UPDATE,R,P)}if(this.autoApplyChanges){for(var O in this._buffers){var R=this._buffers[O];R._processed={};R._added=[];R._changed={};R._deleted=[]}}if(!this._async){if(this._isBatchComplete(P)){var S=this._isBatchSuccess(P);var Q={batch:P,success:S};this._undefWorkingRecord();this._fireAfterSaveChanges(S,Q)}}return T};this._syncSingleTable=function(){var ab,ac;if(!this._defaultTableRef){return}var R=this._defaultTableRef;var U={operations:[]};if(typeof($)=="function"&&typeof($.Deferred)=="function"){ab=$.Deferred();ac=ab.promise();U.deferred=ab}var Q=false;var V={};for(var T=0;T<R._added.length;T++){var O=R._added[T];V[O]=O}for(var T=0;T<R._deleted.length;T++){var aa=R._deleted[T];if(!aa){continue}var O=aa.data._id;if(V[O]){var S={success:true,xhr:undefined,operation:progress.data.JSDO._OP_DELETE,batch:U,jsrecord:aa,jsdo:this};U.operations.push(S);R._processed[O]=aa.data;var X=S.jsdo;try{S.jsrecord._tableRef.trigger("afterDelete",X,S.jsrecord,S.success,S);X.trigger("afterDelete",X,S.jsrecord,S.success,S)}finally{S.complete=true}Q=true}}V=null;for(var T=0;T<R._deleted.length;T++){var aa=R._deleted[T];if(!aa){continue}var O=aa.data._id;if(R._processed[O]){continue}R._processed[O]=aa.data;Q=false;var Z=new XMLHttpRequest();Z.jsdo=this;var S={xhr:Z,operation:progress.data.JSDO._OP_DELETE,batch:U,jsrecord:aa,jsdo:this};U.operations.push(S);Z.onCompleteFn=this._deleteComplete;Z.onSuccessFn=this._deleteSuccess;Z.onErrorFn=this._deleteError;Z.onreadystatechange=this.onReadyStateChangeGeneric;Z.request=S;aa._tableRef.trigger("beforeDelete",this,aa,S);this.trigger("beforeDelete",this,aa,S);var P={};if(this._resource.service&&this._resource.service.settings&&this._resource.service.settings.sendOnlyChanges){if(this._resource.idProperty){P[this._resource.idProperty]=aa.data[this._resource.idProperty]}else{throw new Error(b.getMsgText("jsdoMSG110",this._resource.name," for sendOnlyChanges property"))}}else{P=aa.data}if(this._resource){if(typeof(this._resource.generic["delete"])=="function"){Z.objParam=P;this._resource.generic["delete"](Z,this._async)}else{throw new Error("JSDO: DELETE operation is not defined.")}}else{this._session._openRequest(Z,"DELETE",this.url+"/"+O,true);try{Z.send(null)}catch(W){S.success=false;S.exception=W;Z.jsdo._session._checkServiceResponse(Z,S.success,S)}}}for(var T=0;T<R._added.length;T++){var O=R._added[T];var aa=R._findById(O,false);if(!aa){continue}if(R._processed[O]){continue}R._processed[O]=aa.data;Q=false;var Z=new XMLHttpRequest();Z.jsdo=this;var S={xhr:Z,jsrecord:aa,batch:U,operation:progress.data.JSDO._OP_CREATE,jsdo:this};U.operations.push(S);Z.onCompleteFn=this._createComplete;Z.onSuccessFn=this._createSuccess;Z.onErrorFn=this._createError;Z.onreadystatechange=this.onReadyStateChangeGeneric;Z.request=S;aa._tableRef.trigger("beforeCreate",this,aa,S);this.trigger("beforeCreate",this,aa,S);if(this._resource){if(typeof(this._resource.generic.create)=="function"){var v={};if(this._resource.idProperty!==undefined&&aa.data._id!==undefined){this._copyRecord(aa._tableRef,aa.data,v);delete v._id;Z.objParam=v}else{Z.objParam=aa.data}this._resource.generic.create(Z,this._async)}else{throw new Error("JSDO: CREATE operation is not defined.")}}else{this._session._openRequest(Z,"POST",this.url,true);Z.setRequestHeader("Content-Type","application/json; charset=utf-8");var Y=JSON.stringify(aa.data);try{Z.send(Y)}catch(W){S.success=false;S.exception=W;Z.jsdo._session._checkServiceResponse(Z,S.success,S)}}}for(var O in R._changed){var aa=R._findById(O,false);if(!aa){continue}if(R._processed[O]){continue}R._processed[O]=aa.data;Q=false;var Z=new XMLHttpRequest();var S={xhr:Z,jsrecord:aa,operation:progress.data.JSDO._OP_UPDATE,batch:U,jsdo:this};Z.request=S;Z.jsdo=this;U.operations.push(S);Z.onCompleteFn=this._updateComplete;Z.onSuccessFn=this._updateSuccess;Z.onErrorFn=this._updateError;Z.onreadystatechange=this.onReadyStateChangeGeneric;aa._tableRef.trigger("beforeUpdate",this,aa,S);this.trigger("beforeUpdate",this,aa,S);var P={};if(this._resource.service&&this._resource.service.settings&&this._resource.service.settings.sendOnlyChanges){R._jsdo._copyRecord(R,aa.data,P,R._beforeImage[aa.data._id]);if(this._resource.idProperty){P[this._resource.idProperty]=aa.data[this._resource.idProperty]}else{throw new Error(b.getMsgText("jsdoMSG110",this._resource.name," for sendOnlyChanges property"))}}else{P=aa.data}if(this._resource){if(typeof(this._resource.generic.update)=="function"){Z.objParam=P;this._resource.generic.update(Z,this._async)}else{throw new Error("JSDO: UPDATE operation is not defined.")}}else{this._session._openRequest(Z,"PUT",this.url+"/"+O,this._async);Z.setRequestHeader("Content-Type","application/json; charset=utf-8");var Y=JSON.stringify(aa.data);try{Z.send(Y)}catch(W){S.success=false;S.exception=W;Z.jsdo._session._checkServiceResponse(Z,S.success,S)}}}if(this.autoApplyChanges){R._beforeImage={};R._added=[];R._changed={};R._deleted=[];R._processed={}}if(!this._async){Q=true}if(Q){var X=this;var S={batch:U,success:true};X._undefWorkingRecord();X._fireAfterSaveChanges(S.success,S)}return ac};this._syncDataSetForSubmit=function(P){var v,Q;if(typeof($)=="function"&&typeof($.Deferred)=="function"){v=$.Deferred();Q=v.promise();P.deferred=v}P.jsrecords=[];var O=this._createChangeSet(this._dataSetName,false,P);this._execGenericOperation(progress.data.JSDO._OP_SUBMIT,O,P,this._saveChangesComplete,this._saveChangesSuccess,this._saveChangesError);return Q};this._createChangeSet=function(T,O,R){var V={};V[T]={};var P=V[T];var S=P["prods:hasChanges"]=this._hasChanges();if(S){if((O===true)){for(var v in this._buffers){P[this._buffers[v]._name]=[]}}for(var v in this._buffers){var Q=this._buffers[v];this._addDeletesToChangeSet(Q,P,R)}for(var v in this._buffers){var Q=this._buffers[v];this._addCreatesToChangeSet(Q,P,R)}for(var v in this._buffers){var Q=this._buffers[v];this._addChangesToChangeSet(Q,P,R)}for(var v in this._buffers){this._buffers[v]._processed={}}}var U=Object.keys(V[T]);if(U.length==1&&U[0]=="prods:hasChanges"){for(var v in this._buffers){P[this._buffers[v]._name]=[]}P["prods:hasChanges"]=false}return V};this._createDataAndChangeSet=function(P){var O={};O[P]={};var R=O[P];for(var v in this._buffers){R[this._buffers[v]._name]=[]}if(this._hasChanges()){R["prods:hasChanges"]=true}for(var v in this._buffers){var Q=this._buffers[v];this._addRecordsToObject(Q,R)}for(var v in this._buffers){var Q=this._buffers[v];this._addDeletesToChangeSet(Q,R)}for(var v in this._buffers){this._buffers[v]._processed={}}return O};this._addRecordsToObject=function(S,R){if(S._data.length>0&&!R[S._name]){R[S._name]=[]}for(var P=0;P<S._data.length;P++){var O=S._data[P];if(!O){continue}if(this._doesRecordHaveCreateBIData(S,O._id)===true){var v=S._findById(O._id,false);if(!v){continue}if(S._processed[v.data._id]){continue}this._addCreatedRowToChangeSet(S,v,R)}if(this._doesRecordHaveUpdateBIData(S,O._id)===true){var v=S._findById(O._id,false);if(!v){continue}if(S._processed[v.data._id]){continue}this._addChangedRowToChangeSet(S,v,R)}else{if(S._processed[O._id]){continue}S._processed[O._id]=O;var Q={};S._jsdo._copyRecord(S,O,Q);delete Q._id;R[S._name].push(Q)}}};this._doesRecordHaveCreateBIData=function(O,P){for(var v=0;v<O._added.length;v++){if(O._added[v]===P){return true}}return false};this._doesRecordHaveUpdateBIData=function(O,P){for(var v in O._changed){if(v===P){return true}}return false};this._hasChanges=function(){var v=false;for(var P in this._buffers){var Q=this._buffers[P];var O=false;for(var R in Q._changed){O=true;break}if(Q._deleted.length>0||Q._added.length>0||O){v=true;break}}return v};this._addDeletesToChangeSet=function(R,Q,P){for(var O=0;O<R._deleted.length;O++){var v=R._deleted[O];if(!v){continue}if(v.data&&v.data._id!==undefined&&R._beforeImage[v.data._id]===null){continue}this._addDeletedRowToChangeSet(R,v,Q,P)}};this._addDeletedRowToChangeSet=function(S,v,R,P){S._processed[v.data._id]=v.data;v.data["prods:rowState"]="deleted";if(typeof(P)!="undefined"){P.jsrecords.push(v);v._tableRef.trigger("beforeDelete",this,v,P);this.trigger("beforeDelete",this,v,P)}var Q={};Q["prods:clientId"]=v.data._id;Q["prods:rowState"]="deleted";var O=this._getTableInBeforeJsonObject(R,S._name);S._jsdo._copyRecord(S,S._beforeImage[v.data._id],Q);delete Q._id;O.push(Q)};this._addCreatesToChangeSet=function(R,Q,P){for(var O=0;O<R._added.length;O++){var S=R._added[O];var v=R._findById(S,false);if(!v){continue}if(R._processed[v.data._id]){continue}this._addCreatedRowToChangeSet(R,v,Q,P)}};this._addCreatedRowToChangeSet=function(R,v,Q,O){R._processed[v.data._id]=v.data;if(!Q[R._name]){Q[R._name]=[]}v.data["prods:rowState"]="created";if(typeof(O)!="undefined"){O.jsrecords.push(v);v._tableRef.trigger("beforeCreate",this,v,O);this.trigger("beforeCreate",this,v,O)}var P={};P["prods:clientId"]=v.data._id;P["prods:rowState"]="created";R._jsdo._copyRecord(R,v.data,P);delete P._id;Q[R._name].push(P)};this._addChangesToChangeSet=function(Q,P,O){for(var R in Q._changed){var v=Q._findById(R,false);if(!v){continue}if(Q._processed[v.data._id]){continue}this._addChangedRowToChangeSet(Q,v,P,O)}};this._addChangedRowToChangeSet=function(T,v,S,P){T._processed[v.data._id]=v.data;if(!S[T._name]){S[T._name]=[]}v.data["prods:rowState"]="modified";if(typeof(P)!="undefined"){P.jsrecords.push(v);v._tableRef.trigger("beforeUpdate",this,v,P);this.trigger("beforeUpdate",this,v,P)}var Q={};Q["prods:id"]=v.data._id;Q["prods:clientId"]=v.data._id;Q["prods:rowState"]="modified";T._jsdo._copyRecord(T,v.data,Q);delete Q._id;S[T._name].push(Q);var O=this._getTableInBeforeJsonObject(S,T._name);var R={};R["prods:id"]=v.data._id;T._jsdo._copyRecord(T,T._beforeImage[v.data._id],R);O.push(R)};this._getTableInBeforeJsonObject=function(P,O){if(!P["prods:before"]){P["prods:before"]={}}var v=P["prods:before"];if(!v[O]){v[O]=[]}return v[O]};this.addRecords=function(R,O,T,S,v){if(this.isDataSet()){if(R instanceof Array){if(!this._defaultTableRef){throw new Error(b.getMsgText("jsdoMSG998"))}}else{if(R===undefined||R===null){R={}}if(R[this._dataSetName]){R=R[this._dataSetName]}}if(O!=progress.data.JSDO.MODE_EMPTY){if(Object.keys(R).length===0){throw new Error(b.getMsgText("jsdoMSG006"))}}var Q=this.useRelationships;this.useRelationships=false;try{for(var P in this._buffers){if(R[this._buffers[P]._name]){this._addRecords(this._buffers[P]._name,R,O,T,S,v)}else{if(O==progress.data.JSDO.MODE_EMPTY){this._buffers[this._buffers[P]._name]._clearData()}}}}finally{this.useRelationships=Q}}else{if(this._defaultTableRef){this._addRecords(this._defaultTableRef._name,R,O,T,S,v)}}};this._copyRecord=function(S,P,R,v){for(var Q in P){if(v!==undefined){if(P[Q]==v[Q]){continue}}if(P[Q]===undefined||P[Q]===null){R[Q]=P[Q]}else{if(P[Q] instanceof Date){R[Q]=P[Q]}else{if(typeof P[Q]==="object"){var O=P[Q] instanceof Array?[]:{};this._copyRecord(S,P[Q],O);R[Q]=O}else{R[Q]=P[Q]}}}}};this._deleteProdsProperties=function(O,v,P){if(typeof(v)=="undefined"){v=false}if(typeof(P)=="undefined"){P=true}if(O){delete O["prods:id"];delete O["prods:hasErrors"];delete O["prods:clientId"];if(P){delete O["prods:rowState"]}if(v){delete O._errorString}}};this._addRecords=function(Q,V,W,S,Z,X){var ag=null;var O=null;if(V&&(this._dataSetName!==undefined)){if(V[this._dataSetName]&&V[this._dataSetName]["prods:hasChanges"]){ag=V;O={}}else{if(V["prods:hasChanges"]){ag={};ag[this._dataSetName]=V;O={}}}}if(typeof(Q)!="string"){throw new Error(b.getMsgText("jsdoMSG020"))}if(!W){throw new Error(b.getMsgText("jsdoMSG021"))}switch(W){case progress.data.JSDO.MODE_APPEND:case progress.data.JSDO.MODE_EMPTY:case progress.data.JSDO.MODE_MERGE:case progress.data.JSDO.MODE_REPLACE:break;default:throw new Error(b.getMsgText("jsdoMSG022"))}if(!S){S=[]}else{if(!(S instanceof Array)&&(typeof(S)=="object")){if(S[Q]){S=S[Q]}else{S=[]}}}if(!(S instanceof Array)){throw new Error(b.getMsgText("jsdoMSG008"))}if(this._buffers[Q]._fields){for(var af=0;af<S.length;af++){var v=this._buffers[Q]._fields[S[af].toLowerCase()];if(v===undefined){throw new Error(b.getMsgText("jsdoMSG009",S[af]))}else{S[af]=v.name}}}Z=Z?true:false;if(Q){if(!(V instanceof Array)){var ai=null;if(V===undefined||V===null){V={}}if(this.isDataSet()){if(V[this._dataSetName]){ai=V[this._dataSetName][Q]}else{if(V[Q]){ai=V[Q]}}}else{if(this._dataProperty){ai=V[this._dataProperty]}else{if(V.data){ai=V.data}}}if(ai instanceof Array){saveJsonObject=V;V=ai}else{if((W==progress.data.JSDO.MODE_EMPTY)&&(typeof(V)=="object")&&(Object.keys(V).length===0)){V=[]}else{if((W==progress.data.JSDO.MODE_REPLACE)&&(typeof(V)=="object")&&(ag)){V=[]}}}}if(!(V instanceof Array)){throw new Error(b.getMsgText("jsdoMSG005",Q))}var Y=false;try{this._buffers[Q]._sortRecords=false;if(S.length===0||W==progress.data.JSDO.MODE_EMPTY){if(W==progress.data.JSDO.MODE_EMPTY){this._buffers[Q]._clearData()}for(var af=0;af<V.length;af++){var ab=this._buffers[Q]._add(V[af],Z,false);V[af]._id=ab.data._id;if(O&&V[af]["prods:id"]){O[V[af]["prods:id"]]=ab.data._id}if(ag){this._deleteProdsProperties(ab.data)}}}else{var ad;if(this._buffers[Q]._data.length*V.length>=10){ad={};for(var af=0;af<this._buffers[Q]._data.length;af++){var P=this._buffers[Q]._data[af];if(!P){continue}var aj=this._buffers[Q]._getKey(P,S);ad[aj]=P}}else{ad=null}var ac=(Object.keys(this._buffers[Q]._beforeImage).length!==0);for(var af=0;af<V.length;af++){var U=false;var P=null;if(ad){var aj=this._buffers[Q]._getKey(V[af],S);P=ad[aj];U=(P!==undefined)}else{for(var ae=0;ae<this._buffers[Q]._data.length;ae++){P=this._buffers[Q]._data[ae];if(!P){continue}U=(this._buffers[Q]._equalRecord(V[af],P,S));if(U){break}}}if(U){if(X&&(this._resource.idProperty!==undefined)&&(V[af]._id===undefined)){V[af]._id=P._id}var ah=this._buffers[Q]._beforeImage[P._id];if(ac&&(V[af]["prods:id"]!==undefined)&&(typeof ah!=="undefined")){var aa=this._sameData(V[af],P);var R=true;if(ah){var T=this._getBeforeRecordFromObject(V[af],ag,Q);if(T){R=this._sameData(T,ah)}}if(!aa||!R){throw new Error(b.getMsgText("jsdoMSG032"))}}switch(W){case progress.data.JSDO.MODE_APPEND:throw new Error(b.getMsgText("jsdoMSG023"));case progress.data.JSDO.MODE_MERGE:if(O&&V[af]["prods:id"]){O[V[af]["prods:id"]]=P._id}break;case progress.data.JSDO.MODE_REPLACE:if(O&&V[af]["prods:id"]){O[V[af]["prods:id"]]=P._id}if(V[af]._id===undefined){V[af]._id=P._id}this._copyRecord(this._buffers[Q],V[af],P);this._deleteProdsProperties(P);break;default:break}}else{var ab=this._buffers[Q]._add(V[af],Z,false);V[af]._id=ab.data._id;if(O&&V[af]["prods:id"]){O[V[af]["prods:id"]]=ab.data._id}if(ag){this._deleteProdsProperties(ab.data)}if(ad){var aj=this._buffers[Q]._getKey(ab.data,S);ad[aj]=ab.data}}}ad=null}Y=true}finally{this._buffers[Q]._sortRecords=true;this._buffers[Q]._sort();this._buffers[Q]._createIndex();if(Y&&ag){this._buffers[Q]._loadBeforeImageData(ag,O,S)}}}};this._getBeforeRecordFromObject=function(T,R,S){var Q=R[this._dataSetName]["prods:before"];var U=T["prods:id"];var v;if(!Q){return v}for(var P=0;P<Q[S].length;P++){var O=Q[S][P];if(O["prods:id"]&&U==O["prods:id"]){v=O;break}}return v};this._sameData=function(Q,O){var P,v;for(var R in Q){if(R.substring(0,5)!="prods"&&R!="_id"){P=Q[R];v=O[R];if(P>v||P===null){return false}else{if(P<v||v===null){return false}}}}return true};this._mergeRead=function(Q,T){if(this.isDataSet()){if(this._dataProperty){var U=this._buffers[this._dataProperty];U._data=Q[this._dataSetName][this._dataProperty];if(U.autoSort){U._sort()}U._createIndex()}else{for(var O in this._buffers){var R;if(Q[this._dataSetName]){R=Q[this._dataSetName][O]}else{R=null}R=R?R:[];this._buffers[O]._data=R;if(this._buffers[O].autoSort){this._buffers[O]._sort()}this._buffers[O]._createIndex();if(Q[this._dataSetName]&&Q[this._dataSetName]["prods:hasChanges"]){this._buffers[O]._loadBeforeImageData(Q)}}if(this._numBuffers>1){for(var O in this._buffers){if(this._buffers[O]._isNested&&this._buffers[O]._parent&&this._buffers[this._buffers[O]._parent]){var S=this._buffers[this._buffers[O]._parent]._data;var R=[];for(var P=0;P<S.length;P++){if(S[P][O]!==undefined){for(var v=0;v<S[P][O].length;v++){R.push(S[P][O][v])}delete S[P][O]}}this._buffers[O]._data=R;if(this._buffers[O].autoSort){this._buffers[O]._sort()}this._buffers[O]._createIndex()}}}}}else{if(Q instanceof Array){this._defaultTableRef._data=Q}else{if(this._dataProperty){this._defaultTableRef._data=Q[this._dataProperty]}else{if(Q.data){this._defaultTableRef._data=Q.data}else{this._defaultTableRef._data=[];this._defaultTableRef._data[0]=Q}}}}for(var O in this._buffers){if(this._buffers[O].autoSort){this._buffers[O]._sort()}this._buffers[O]._createIndex()}};this._mergeUpdateRecord=function(Q,P,v){var O=Q._index[P].index;v._id=P;Q._data[O]=v;if(Q._jsdo._resource.idProperty!==undefined){var R=Q._data[O][Q._jsdo._resource.idProperty];if(R!==undefined){delete Q._index[P];R+="";Q._index[R]=new progress.data.JSIndexEntry(O);v._id=R}}return v};this._setErrorString=function(R,P,Q,v){if(v){R._beforeImage[P]._errorString=Q}else{var O=R._index[P].index;R._data[O]._errorString=Q}};this._arrayFromDataObject=function(v,P){var O;if(v===undefined){return undefined}if(this._dataSetName){if(v[this._dataSetName]){O=v[this._dataSetName][P._name]}}else{if(v instanceof Array){O=v}else{if(this._dataProperty){O=v[this._dataProperty]}else{if(v.data){O=v.data}}}}return O};this._mergeUpdateForCUD=function(W,Z){var X=false,R;if(this._dataSetName){var P=W[this._dataSetName];var O=P["prods:before"];var Q=Z.request.jsrecord._tableRef;var S=this._arrayFromDataObject(W,Q);if(S instanceof Array){if(S.length>1){Z.request.success=false;throw new Error(b.getMsgText("jsdoMSG100"))}for(var U=0;U<S.length;U++){var v=Z.request.jsrecord.getId();if(!v){throw new Error(b.getMsgText("jsdoMSG034","_mergeUpdateForCUD()"))}R=undefined;if(S[U]["prods:hasErrors"]){var Y=S[U]["prods:id"];R=this._getErrorStringFromJsonObject(P,Q,Y);X=true}var V=this._mergeUpdateRecord(Q,v,S[U]);if(R){this._setErrorString(Q,v,R,false)}Z.request.jsrecord=new progress.data.JSRecord(Q,V)}}}else{var Q=this._defaultTableRef;var T=this._arrayFromDataObject(W);if(T instanceof Array){if(T.length>1){Z.request.success=false;throw new Error(b.getMsgText("jsdoMSG100"))}for(var U=0;U<T.length;U++){var v=Z.request.jsrecord.getId();if(!v){throw new Error(b.getMsgText("jsdoMSG034","_mergeUpdateForCUD()"))}var V=this._mergeUpdateRecord(Q,v,T[U]);Z.request.jsrecord=new progress.data.JSRecord(Q,V)}}}return X};this._checkForDeleteError=function(T,U){var v=false;var S=U.request.jsrecord._tableRef;beforeJsonObject=T["prods:before"];if(beforeJsonObject){var Q=beforeJsonObject[S._name];if(Q.length>1){U.request.success=false;throw new Error(b.getMsgText("jsdoMSG100"))}var P=Q[0]["prods:clientId"];if(!P){throw new Error(b.getMsgText("jsdoMSG035","_checkForDeleteError()"))}if(Q[0]["prods:hasErrors"]){var O=Q[0]["prods:id"];var R=this._getErrorStringFromJsonObject(T,S,O);this._setErrorString(S,P,R,true);v=true}}return v};this._mergeUpdateForSubmit=function(X,ab){var S;if(!this._dataSetName){throw new Error(b.getMsgText("jsdoMSG036","_mergeUpdateForSubmit()"))}var Q=X[this._dataSetName];if(Q[this._dataSetName]){Q=Q[this._dataSetName]}var P=Q["prods:before"];for(var v in this._buffers){var R=this._buffers[v];var T=Q[R._name];if(T instanceof Array){for(var V=0;V<T.length;V++){var O=T[V]["prods:clientId"];if(!O){throw new Error(b.getMsgText("jsdoMSG035","_mergeUpdateForSubmit()"))}S=undefined;if(T[V]["prods:hasErrors"]){var aa=T[V]["prods:id"];S=this._getErrorStringFromJsonObject(Q,R,aa)}var W=this._mergeUpdateRecord(R,O,T[V]);if(S){this._setErrorString(R,O,S,false)}var U=ab.request.jsrecords;for(var Z=0;Z<U.length;Z++){if(U[Z].data._id==O){U[Z].data=W;break}}}}}if(P){for(var v in this._buffers){var R=this._buffers[v];var Y=P[R._name];if(Y instanceof Array){for(var V=0;V<Y.length;V++){if(Y[V]["prods:rowState"]=="deleted"){var O=Y[V]["prods:clientId"];if(!O){throw new Error(b.getMsgText("jsdoMSG035","_mergeUpdateForSubmit()"))}if(Y[V]["prods:hasErrors"]){var aa=Y[V]["prods:id"];var S=this._getErrorStringFromJsonObject(Q,R,aa);this._setErrorString(R,O,S,true)}}}}}}};this._fireCUDTriggersForSubmit=function(P){for(var v=0;v<P.jsrecords.length;v++){this._deleteProdsProperties(P.jsrecords[v].data,false,false)}for(var v=0;v<P.jsrecords.length;v++){var O=P.jsrecords[v];switch(O.data["prods:rowState"]){case"created":O._tableRef.trigger("afterCreate",this,O,P.success,P);this.trigger("afterCreate",this,O,P.success,P);break;case"modified":O._tableRef.trigger("afterUpdate",this,O,P.success,P);this.trigger("afterUpdate",this,O,P.success,P);break;case"deleted":O._tableRef.trigger("afterDelete",this,O,P.success,P);this.trigger("afterDelete",this,O,P.success,P);break}}};this._getErrorStringFromJsonObject=function(S,R,v){var T;var Q=S["prods:errors"];if(Q){T=Q[R._name]}if(T instanceof Array){for(var O=0;O<T.length;O++){var U=T[O]["prods:id"];if(U===v){var P=T[O]["prods:error"];return P===null?"Server returned unspecified error. Please check log files.":P}}}return undefined};this._fillSuccess=function(O,R,P){var Q=P.xhr;O._clearData();O._mergeRead(P.response,Q);for(var v in O._buffers){if(!O._buffers[v]._parent||!O.useRelationships){O._buffers[v]._setRecord(O._buffers[v]._findFirst())}}};this._fillComplete=function(v,P,O){v.trigger("afterFill",v,O.success,O);if(O.deferred){if(P){O.deferred.resolve(v,P,O)}else{O.deferred.reject(v,P,O)}}};this._fillError=function(v,P,O){v._clearData()};this._undoCreate=function(P,Q){var O=P._index[Q];if(O!==undefined){var v=O.index;P._data[v]=null}P._hasEmptyBlocks=true;delete P._index[Q];delete P._beforeImage[Q]};this._undoUpdate=function(Q,R,P){if(typeof(P)=="undefined"){P=false}var v=Q._beforeImage[R];if(v){var O=Q._index[R].index;Q._jsdo._copyRecord(Q,v,Q._data[O]);if(P){Q._jsdo._deleteProdsProperties(Q._data[O],true)}}delete Q._beforeImage[R]};this._undoDelete=function(Q,R,P){if(typeof(P)=="undefined"){P=false}var v=Q._beforeImage[R];if(v){var O=v._index;delete v._index;if(P){Q._jsdo._deleteProdsProperties(v,true)}if((O!==undefined)&&(Q._data[O]===null)){Q._data[O]=v}else{Q._data.push(v);O=Q._data.length-1}Q._index[R]=new progress.data.JSIndexEntry(O)}delete Q._beforeImage[R]};this._deleteComplete=function(O,R,P){var Q=P.xhr;var v=P.jsrecord;try{O._deleteProdsProperties(v.data,false);v._tableRef.trigger("afterDelete",O,v,P.success,P);O.trigger("afterDelete",O,v,P.success,P)}finally{P.complete=true;O._checkSaveComplete(Q)}};this._deleteSuccess=function(S,U,P){var V=P.xhr;var R=P.response;var v=null;var O=null;var Q;var T=false;if(S._useBeforeImage("delete")){O=R[S._dataSetName];v=O["prods:before"];if(v){Q=v[P.jsrecord._tableRef._name]}}else{Q=S._arrayFromDataObject(R,P.jsrecord._tableRef)}if(Q instanceof Array){if(Q.length>1){P.success=false;throw new Error(b.getMsgText("jsdoMSG100"))}}if(v){T=S._checkForDeleteError(O,V)}if(T){P.success=false}if(S.autoApplyChanges){if(!T){delete P.jsrecord._tableRef._beforeImage[P.jsrecord.data._id]}else{S._deleteError(S,U,P)}}};this._deleteError=function(v,P,O){if(v.autoApplyChanges){v._undoDelete(O.jsrecord._tableRef,O.jsrecord.data._id)}};this._createComplete=function(O,R,P){var Q=P.xhr;var v=P.jsrecord;try{O._deleteProdsProperties(v.data,false);v._tableRef.trigger("afterCreate",O,v,P.success,P);O.trigger("afterCreate",O,v,P.success,P)}finally{P.complete=true;O._checkSaveComplete(Q)}};this._createSuccess=function(P,S,Q){var R=Q.xhr;var O=Q.response;var v=P._mergeUpdateForCUD(O,R);if(v){Q.success=false}if(P.autoApplyChanges){if(!v){delete Q.jsrecord._tableRef._beforeImage[Q.jsrecord.data._id]}else{P._createError(P,S,Q)}}};this._createError=function(v,P,O){if(v.autoApplyChanges){v._undoCreate(O.jsrecord._tableRef,O.jsrecord.data._id)}};this._updateComplete=function(O,R,P){var Q=P.xhr;var v=P.jsrecord;try{O._deleteProdsProperties(v.data,false);v._tableRef.trigger("afterUpdate",O,v,P.success,P);O.trigger("afterUpdate",O,v,P.success,P)}finally{P.complete=true;O._checkSaveComplete(Q)}};this._updateSuccess=function(O,R,P){var Q=P.xhr;var v=O._mergeUpdateForCUD(P.response,Q);if(v){P.success=false}if(O.autoApplyChanges){if(!v){P.success=true;delete P.jsrecord._tableRef._beforeImage[P.jsrecord.data._id]}else{O._updateError(O,R,P)}}};this._updateError=function(v,Q,P){var O=true;if(v.autoApplyChanges){P.success=false;v._undoUpdate(P.jsrecord._tableRef,P.jsrecord.data._id)}};this._saveChangesSuccess=function(O,R,Q){var v=Q.response;O._mergeUpdateForSubmit(v,Q.xhr);O._lastErrors=[];var P=O.getChanges();O._updateLastErrors(O,null,P);if(O.autoApplyChanges){O._applyChanges()}};this._saveChangesError=function(v,P,O){if(v.autoApplyChanges){v.rejectChanges()}};this._saveChangesComplete=function(v,P,O){if((O.xhr.status>=200&&O.xhr.status<300)&&v._lastErrors.length>0){O.success=false}if(v._useSubmit===true){v._fireCUDTriggersForSubmit(O)}v._undefWorkingRecord();v._fireAfterSaveChanges(O.success,O)};this._fireAfterSaveChanges=function(R,Q){this.trigger("afterSaveChanges",this,R,Q);if(Q.jsrecords){if(Q.deferred){if(R){Q.deferred.resolve(this,R,Q)}else{Q.deferred.reject(this,R,Q)}}}else{if(Q.batch&&Q.batch.deferred){if(R){Q.batch.deferred.resolve(this,R,Q)}else{Q.batch.deferred.reject(this,R,Q)}}}var O=this.autoApplyChanges;if(Q.jsrecords){for(var v=0;v<Q.jsrecords.length;v++){var P=Q.jsrecords[v];if(O){delete P.data._errorString}delete P.data["prods:rowState"]}}else{if(Q.batch&&Q.batch.operations){for(var v=0;v<Q.batch.operations.length;v++){var P=Q.batch.operations[v].jsrecord;if(O){delete P.data._errorString}}}}};this._updateLastErrors=function(T,R,U){if(R){if(R.operations===undefined){return}for(var Q=0;Q<R.operations.length;Q++){var O=R.operations[Q];if(!O.success&&O.xhr&&O.xhr.status==500){var V="";try{var v=JSON.parse(O.xhr.responseText);if(v._errors instanceof Array){for(var P=0;P<v._errors.length;P++){V+=v._errors[P]._errorMsg+"\n"}}if(v._retVal){V+=v._retVal}}catch(S){}if(O.exception){if(V.length===0){V=O.exception}else{V+="\n"+O.exception}}T._lastErrors.push({errorString:V})}}}else{if(U instanceof Array){for(var Q=0;Q<U.length;Q++){if(U[Q].record&&U[Q].record.data._errorString!==undefined){T._lastErrors.push({errorString:U[Q].record.data._errorString})}}}}};this._checkSaveComplete=function(R){if(R.request){var O=R.request.jsdo;var v=R.request.batch;if(O&&v&&O._async){if(O._isBatchComplete(v)){var Q=O._isBatchSuccess(v);var P={batch:v,success:Q};O._undefWorkingRecord();O._lastErrors=[];if(!Q&&v.operations){O._updateLastErrors(O,v,null)}O._fireAfterSaveChanges(Q,P)}}}};this._isBatchSuccess=function(v){if(v.operations){for(var O=0;O<v.operations.length;O++){if(!v.operations[O].success){return false}}}return true};this._isBatchComplete=function(v){if(v.operations){for(var O=0;O<v.operations.length;O++){var P=v.operations[O];if(!P.complete){return false}}}return true};this._mergeInvoke=function(P,U){var v;if(U.request.fnName!==undefined&&U.jsdo._resource.fn[U.request.fnName]!==undefined){v=U.jsdo._resource.fn[U.request.fnName].operation}else{v=null}if(v===undefined){v=null;for(var O=0;O<U.jsdo._resource.operations.length;O++){if(U.jsdo._resource.operations[O].name==U.request.fnName){v=U.jsdo._resource.operations[O];break}}U.jsdo._resource.fn[U.request.fnName].operation=v}if(v!==null&&v.mergeMode){try{var Q=progress.data.JSDO["MODE_"+v.mergeMode.toUpperCase()];if(Q===null){throw new Error(b.getMsgText("jsdoMSG030","mergeMode property","EMPTY, APPEND, MERGE or REPLACE"))}if(U.jsdo._resource.idProperty===undefined){throw new Error(b.getMsgText("jsdoMSG110",this._resource.name," by mergeMode property in invoke operation"))}var T;if(U.jsdo.isDataSet()){T=U.jsdo._resource._dataSetName}else{if(U.jsdo._resource.dataProperty!==undefined){T=U.jsdo._resource.dataProperty}else{if(U.jsdo._resource._tempTableName!==undefined){T=U.jsdo._resource._tempTableName}else{throw new Error(b.getMsgText("jsdoMSG111",""))}}}var R=false;for(var O=0;O<v.params.length;O++){if(v.params[O].name==T){if(v.params[O].type.indexOf("RESPONSE_BODY")!=-1){if((v.params[O].xType!==undefined)&&(v.params[O].xType!="DATASET")&&(v.params[O].xType!="TABLE")&&(v.params[O].xType!="ARRAY")){throw new Error(b.getMsgText("jsdoMSG113",v.params[O].xType,T,U.request.fnName))}R=true;break}}}if(!R){throw new Error(b.getMsgText("jsdoMSG112",T,U.request.fnName))}U.jsdo.addRecords(U.request.response[T],Q,[U.jsdo._resource.idProperty],false,true)}catch(S){U.request.success=false;U.request.exception=S}}};this.onReadyStateChangeGeneric=function(){var Q=this;if(Q.readyState==4){var O=Q.request;try{O.response=JSON.parse(Q.responseText);if(O.response&&O.response.response){O.response=O.response.response}}catch(P){O.response=undefined}try{if((Q.status>=200&&Q.status<300)||(Q.status===0&&Q.responseText!=="")){O.success=true;Q.jsdo._session._saveClientContextId(Q);if((typeof Q.onSuccessFn)=="function"){var v;if(Q.request.fnName!==undefined&&Q.jsdo._resource.fn[Q.request.fnName]!==undefined){v=Q.jsdo._resource.fn[Q.request.fnName].operation}else{v=null}if((v===undefined)||(v!==null&&v.mergeMode)){Q.jsdo._mergeInvoke(O.response,Q)}if(O.success){Q.onSuccessFn(Q.jsdo,O.success,O)}else{if((typeof Q.onErrorFn)=="function"){Q.onErrorFn(Q.jsdo,O.success,O)}}}}else{O.success=false;if(Q.status===0){O.exception=new Error(b.getMsgText("jsdoMSG101"))}if((typeof Q.onErrorFn)=="function"){Q.onErrorFn(Q.jsdo,O.success,O)}}}catch(P){O.exception=P;if((typeof Q.onErrorFn)=="function"){Q.onErrorFn(Q.jsdo,O.success,O)}}Q.jsdo._session._checkServiceResponse(Q,O.success,O);if((typeof Q.onCompleteFn)=="function"){Q.onCompleteFn(Q.jsdo,O.success,O)}}};this.acceptChanges=function(){for(var v in this._buffers){this._buffers[this._buffers[v]._name].acceptChanges()}};this.rejectChanges=function(){for(var v in this._buffers){this._buffers[this._buffers[v]._name].rejectChanges()}};this.getChanges=function(){var v=[];for(var O in this._buffers){var P=this._buffers[this._buffers[O]._name].getChanges();v=v.concat(P)}return v};this.hasChanges=function(){for(var v in this._buffers){if(this._buffers[this._buffers[v]._name].hasChanges()){return true}}return false};this._applyChanges=function(){for(var v in this._buffers){this._buffers[this._buffers[v]._name]._applyChanges()}};this.acceptRowChanges=function(){if(this._defaultTableRef){return this._defaultTableRef.acceptRowChanges()}throw new Error(b.getMsgText("jsdoMSG001","acceptRowChanges()"))};this.rejectRowChanges=function(){if(this._defaultTableRef){return this._defaultTableRef.rejectRowChanges()}throw new Error(b.getMsgText("jsdoMSG001","rejectRowChanges()"))};this.saveLocal=function L(Q,O){var P;var R;if(arguments.length>2){throw new Error(b.getMsgText("jsdoMSG024","JSDO",arguments.callee.name+"()"))}if(typeof(Q)=="string"||Q===null||Q===undefined){P=Q;R=O}else{P=null;R=Q}if(P===undefined||P===null||P===""){P="jsdo_"+this._resource.service.name+"_"+this._resource.name}if(typeof(R)=="undefined"){R=progress.data.JSDO.ALL_DATA}else{switch(R){case progress.data.JSDO.ALL_DATA:case progress.data.JSDO.CHANGES_ONLY:break;default:throw new Error(b.getMsgText("jsdoMSG115",arguments.callee.name))}}if(this._localStorage===null){this._localStorage=new progress.data.LocalStorage()}var v=this._prepareDataObjectForLocalStorage(R);this._localStorage.saveToLocalStorage(P,v)};this.readLocal=function F(O){if(arguments.length>1){throw new Error(b.getMsgText("jsdoMSG024","JSDO",arguments.callee.name+"()"))}if(O===undefined||O===null||O===""){O="jsdo_"+this._resource.service.name+"_"+this._resource.name}else{if(typeof(O)!="string"){throw new Error(b.getMsgText("jsdoMSG116","name",arguments.callee.name+"()"))}}if(this._localStorage===null){this._localStorage=new progress.data.LocalStorage()}var v=this._localStorage.readFromLocalStorage(O);if(v){if(this._hasMatchingSchema(v)===false){throw new Error(b.getMsgText("jsdoMSG117",O))}this._restoreFromLocalStorage(v,progress.data.JSDO.MODE_EMPTY)}return v!==null};this.addLocalRecords=function n(T,R,Q){var v;var S;var O;if(arguments.length<1){throw new Error(b.getMsgText("jsdoMSG024","JSDO",arguments.callee.name+"()"))}if(typeof(T)=="string"){v=T;S=R;O=Q}else{v="jsdo_"+this._resource.service.name+"_"+this._resource.name;S=T;O=R}if(typeof(v)=="undefined"||v===null||v===""){v="jsdo_"+this._resource.service.name+"_"+this._resource.name}else{if(typeof(v)!="string"){throw new Error(b.getMsgText("jsdoMSG116","name",arguments.callee.name+"()"))}}if(S!=progress.data.JSDO.MODE_REPLACE){throw new Error(b.getMsgText("jsdoMSG115",arguments.callee.name))}if(this._localStorage===null){this._localStorage=new progress.data.LocalStorage()}var P=this._localStorage.readFromLocalStorage(v);if(P){if(this._hasMatchingSchema(P)===false){throw new Error(b.getMsgText("jsdoMSG117",v))}try{this._restoreFromLocalStorage(P,S,O)}catch(U){var V=U.message;throw new Error(V.replace(new RegExp("addRecords","g"),"addLocalRecords"))}}return P!==null};this._containsPrimaryKeys=function A(){for(var v in this._buffers){if(this._buffers[v]._primaryKeys===null){return false}}return true};this._hasMatchingSchema=function N(O){var P=true;if(O===null||(Object.keys(O).length===0)){return true}if(this._dataSetName){if(O[this._dataSetName]){for(var v in this._buffers){if(O[this._dataSetName][v]===undefined){P=false;break}}}else{P=false}}else{if(this._dataProperty){O=O._localStorage;if(O===undefined||O[this._dataProperty]===undefined){P=false}}else{O=O._localStorage;if(O===undefined||O[this._defaultTableRef._name]===undefined){P=false}}}return P};this.deleteLocal=function u(v){if(arguments.length>1){throw new Error(b.getMsgText("jsdoMSG024","JSDO",arguments.callee.name+"()"))}if(v===undefined||v===null||v===""){v="jsdo_"+this._resource.service.name+"_"+this._resource.name}else{if(typeof(v)!="string"){throw new Error(b.getMsgText("jsdoMSG116","name",arguments.callee.name+"()"))}}if(this._localStorage===null){this._localStorage=new progress.data.LocalStorage()}this._localStorage.clearLocalStorage(v)};this._prepareDataObjectForLocalStorage=function(O){var v={};if(this._dataSetName){switch(O){case progress.data.JSDO.ALL_DATA:v=this._createDataAndChangeSet(this._dataSetName);break;case progress.data.JSDO.CHANGES_ONLY:v=this._createChangeSet(this._dataSetName,true);break}}else{if(this._dataProperty){switch(O){case progress.data.JSDO.ALL_DATA:v=this._createDataAndChangeSet("_localStorage");break;case progress.data.JSDO.CHANGES_ONLY:v=this._createChangeSet("_localStorage",true);break}}else{switch(O){case progress.data.JSDO.ALL_DATA:v=this._createDataAndChangeSet("_localStorage");break;case progress.data.JSDO.CHANGES_ONLY:v=this._createChangeSet("_localStorage",true);break}}}return v};this._restoreFromLocalStorage=function(P,v,Q){if(P&&(Object.keys(P).length>0)){if(this._dataSetName){for(var O in this._buffers){this._restoreDataForTable(this._buffers[O],P,v,Q)}}else{this._restoreDataForTable(this._defaultTableRef,P,v,Q)}}else{if(v===progress.data.JSDO.MODE_EMPTY){this._clearData()}}};this._restoreDataForTable=function(R,P,v,Q){Q=Q!==undefined?Q:R._primaryKeys;if(Q===undefined&&this._resource.idProperty){Q=[];Q[0]=this._resource.idProperty}if(this._dataSetName){var O=this.useRelationships;this.useRelationships=false;try{R.addRecords(P,v,Q)}finally{this.useRelationships=O}}else{this._dataSetName="_localStorage";R.addRecords(P,v,Q);this._dataSetName=null}};this.getMethodProperties=function(O,P){var v;for(var v=0;v<this._resource.operations.length;v++){if(this._resource.operations[v].type==O){return this._resource.operations[v]}}};if(E){this.fill()}};if((typeof Object.defineProperty)=="function"){Object.defineProperty(progress.data.JSDO,"MODE_APPEND",{value:1,enumerable:true});Object.defineProperty(progress.data.JSDO,"MODE_EMPTY",{value:2,enumerable:true});Object.defineProperty(progress.data.JSDO,"MODE_MERGE",{value:3,enumerable:true});Object.defineProperty(progress.data.JSDO,"MODE_REPLACE",{value:4,enumerable:true})}else{progress.data.JSDO.MODE_APPEND=1;progress.data.JSDO.MODE_EMPTY=2;progress.data.JSDO.MODE_MERGE=3;progress.data.JSDO.MODE_REPLACE=4}progress.data.JSDO._OP_CREATE=1;progress.data.JSDO._OP_READ=2;progress.data.JSDO._OP_UPDATE=3;progress.data.JSDO._OP_DELETE=4;progress.data.JSDO._OP_SUBMIT=5;progress.data.JSDO.ALL_DATA=1;progress.data.JSDO.CHANGES_ONLY=2;progress.data.JSDO.prototype=new progress.util.Observable();progress.data.JSDO.prototype.constructor=progress.data.JSDO;progress.data.JSDO.prototype.toString=function(n){return"JSDO"};progress.data.JSTableRef.prototype=new progress.util.Observable();progress.data.JSTableRef.prototype.constructor=progress.data.JSTableRef;progress.data.JSTableRef.prototype.toString=function(n){return"JSTableRef"};progress.data.PluginManager.addPlugin("JFP",{requestMapping:function(u,r,o){var s,v,p,t,n,q="ablFilter,top,skip,id,orderBy";if(o.operation==="read"){t=u.getMethodProperties(o.operation);n=t.capabilities;if(n){n=n.replace(/\s/g,"")}if(n!==q){throw new Error("JSDO: Capabilities property must be set to '"+q+"'.")}if(r.orderBy){s="";for(i=0;i<r.orderBy.length;i+=1){v=r.orderBy[i].field;if(r.orderBy[i].dir=="desc"){v+=" DESC"}s+=v;if(i<r.orderBy.length-1){s+=","}}}if(r.filter){if(u._defaultTableRef&&r.tableRef===undefined){r.tableRef=u._defaultTableRef._name}if(r.tableRef){p=progress.util._convertToABLWhereString(u._buffers[r.tableRef],r.filter)}else{throw new Error(b.getMsgText("jsdoMSG044","fill()","params","tableRef"))}}filter=JSON.stringify({ablFilter:p,orderBy:s,skip:r.skip,top:r.top});r={filter:filter}}return r}});if(typeof progress.ui=="undefined"){progress.ui={}}progress.ui.UITableRef=function h(o){this._tableRef=o;this._listview=null;this._detailPage=null;this._listviewContent=undefined;this.addItem=function(s){var u;if(!this._tableRef.record){throw new Error(b.getMsgText("jsdoMSG002",this._name))}if(!this._listview){return}s=s?s:this._listview.format;u=(this._detailPage&&this._detailPage.name)?this._detailPage.name:"";if(this._listviewContent===undefined){this.clearItems()}var t=this._listview.itemTemplate?this._listview.itemTemplate:progress.ui.UIHelper._itemTemplate;t=t.replace(new RegExp("{__format__}","g"),s);t=t.replace(new RegExp("{__id__}","g"),this._tableRef.record.data._id);t=t.replace(new RegExp("{__page__}","g"),u);for(var r in this._tableRef.record.data){var q=this._tableRef.record.data[r];t=t.replace(new RegExp("{"+r+"}","g"),(q!==undefined&&q!==null)?q:"")}this._listviewContent+=t};this.clearItems=function(){if(this._listview){this._listviewContent="";var q=document.getElementById(this._listview.name);if(q){q.innerHTML=""}}};this._getFormFieldValue=function(s,q){var r=null;if(q===undefined){if(this._detailPage&&this._detailPage.name){q=this._detailPage.name}}if(typeof($)=="function"&&q){field=$("#"+q+" #"+s);if(!field||field.length===0){field=$("#"+q+' [dsid="'+s+'"]')}if(field&&field.length==1){r=field.val()}}else{field=document.getElementById(s);if(field){r=field.value}}return r};this._setFormField=function(t,r,q){var s=null;if(q===undefined){if(this._detailPage&&this._detailPage.name){q=this._detailPage.name}}if(typeof($)=="function"&&q){s=$("#"+q+" #"+t);if(!s||s.length===0){s=$("#"+q+' [dsid="'+t+'"]')}if(s&&s.length==1){s.val(r)}}else{s=document.getElementById(t);if(s){s.value=r}}};this.assign=function(r){if(!this._tableRef.record){throw new Error(b.getMsgText("jsdoMSG002",this._tableRef._name))}if((arguments.length!==0)&&(typeof r!="string")){throw new Error(b.getMsgText("jsdoMSG024","UIHelper","assign()"))}this._tableRef.record.assign(null);var u;var s=this._tableRef.getSchema();for(var q=0;q<s.length;q++){u=s[q].name;if(u=="_id"){continue}var t=this._getFormFieldValue(u,r);if(typeof t!="undefined"){if(typeof t=="string"&&s[q].type!="string"){t=this._tableRef._jsdo._convertType(t,s[q].type,s[q].items?s[q].items.type:null)}this._tableRef.record.data[u]=t}}this._tableRef.record._sortRecord();return true};this.display=function(q){if(!this._tableRef.record){throw new Error(b.getMsgText("jsdoMSG002",this._tableRef._name))}var s=this._tableRef.getSchema();for(var r=0;r<s.length;r++){this._setFormField(s[r].name,this._tableRef.record.data[s[r].name],q)}this._setFormField("_id",this._tableRef.record.data._id,q)};this.showListView=function(){if(!this._listview){return}var q=this;var r;if(typeof($)=="function"){r=$("#"+this._listview.name);if(r&&r.length==1){r.html(this._listviewContent?this._listviewContent:"");try{if(r.attr("data-filter")==="true"&&typeof r.filterable==="function"){r.filterable("refresh")}else{r.listview("refresh")}}catch(u){}}if(this._listview.autoLink){$("#"+this._listview.name+" li").each(function(){$(this).bind("click",function(){var v=q.getListViewRecord(this);q.display();if(typeof(q._listview.onSelect)=="function"){q._listview.onSelect(event,this,v)}})})}}else{r=document.getElementById(this._listview.name);if(r){r.innerHTML=this._listviewContent}if(this._listview.autoLink){var t=document.getElementById(this._listview.name);if(t&&t.childElementCount>0){for(var s=0;s<t.children.length;s++){t.children[s].onclick=function(){var v=uihelper.getListViewRecord(this);uihelper.display();if(typeof(q._listview.onSelect)=="function"){q._listview.onSelect(event,this,v)}}}}}}this._listviewContent=undefined};this.getFormFields=function(q){if(!this._tableRef._schema){return""}if(!(q instanceof Array)){q=null}else{var u={};for(var t=0;t<q.length;t++){u[q[t]]=q[t]}q=u}var r;if(!q||q._id){r='<input type="hidden" id="_id" name="_id" value="" />'}else{r=""}r+='<fieldset data-role="controlgroup">';for(var t=0;t<this._tableRef._schema.length;t++){var w=this._tableRef._schema[t].name;if(w=="_id"){continue}if(w.length>0&&w.charAt(0)=="_"){continue}if(q&&q[w]===undefined){continue}var s=this._tableRef._schema[t].title?this._tableRef._schema[t].title:this._tableRef._schema[t].name;var v=(this._detailPage&&this._detailPage.fieldTemplate)?this._detailPage.fieldTemplate:progress.ui.UIHelper._fieldTemplate;v=v.replace(new RegExp("{__label__}","g"),s);v=v.replace(new RegExp("{__name__}","g"),this._tableRef._schema[t].name);r+=v}r+="</fieldset>";q=null;return r};this.getListViewRecord=function(q){var r=q.getAttribute("data-id");return this._tableRef.findById(r)};this.getFormRecord=function(q){var r=this._getFormFieldValue("_id",q);return this._tableRef.findById(r)};this._getIdOfElement=function(q){if(typeof($)=="function"){var r=$("#"+q);if(!r||r.length===0){r=$('[dsid="'+q+'"]');if(r&&r.length==1){var s=r.attr("id");if(s){return s}}}}return q};this.setDetailPage=function p(q){if(!q||(typeof(q)!="object")){throw new Error(b.getMsgText("jsdoMSG012",arguments.callee.name,"object"))}if(!q.name||(typeof(q.name)!="string")){throw new Error(b.getMsgText("jsdoMSG012",arguments.callee.name,"name"))}this._detailPage=q;this._detailPage.name=this._getIdOfElement(this._detailPage.name)};this.setListView=function n(r){if(!r||(typeof(r)!="object")){throw new Error(b.getMsgText("jsdoMSG012",arguments.callee.name,"object"))}if(!r.name||(typeof(r.name)!="string")){throw new Error(b.getMsgText("jsdoMSG012",arguments.callee.name,"name"))}if(r.format&&(typeof(r.name)!="string")){throw new Error(b.getMsgText("jsdoMSG012",arguments.callee.name,"format"))}this._listview=r;this._listview.name=this._getIdOfElement(this._listview.name);if(!this._listview.format){if(typeof($)=="function"){for(var q=0;q<this._tableRef._schema.length;q++){var u=this._tableRef._schema[q].name;field=$("#"+this._listview.name+' [dsid="'+u+'"]');if(field&&field.length==1){field.html("{"+u+"}")}}}var s=document.getElementById(this._listview.name).innerHTML;var t=s.indexOf("<li ");if(t!=-1){s=s.substring(0,t)+'<li data-id="{__id__}"'+s.substring(t+3)}this._listview.itemTemplate=s}}};progress.ui.UIHelper=function l(){if(typeof(arguments[0])=="object"){var p=arguments[0];for(var n in p){if(n=="jsdo"){this._jsdo=p[n]}else{this[n]=p[n]}}}this._defaultUITableRef=null;this._uiTableRef={};var q=0;for(var o in this._jsdo._buffers){this[o]=this._uiTableRef[o]=new progress.ui.UITableRef(this._jsdo._buffers[o]);if(!this._defaultUITableRef){this._defaultUITableRef=this._uiTableRef[o]}q++}if(q!=1){this._defaultUITableRef=null}this.addItem=function(r){if(this._defaultUITableRef){this._defaultUITableRef.addItem(r)}else{throw new Error(b.getMsgText("jsdoMSG011","addItem()"))}};this.clearItems=function(){if(this._defaultUITableRef){this._defaultUITableRef.clearItems()}else{throw new Error(b.getMsgText("jsdoMSG011","clearItems()"))}};this.assign=function(r){if(arguments.length!==0){throw new Error(b.getMsgText("jsdoMSG024","UIHelper","assign()"))}if(this._defaultUITableRef){return this._defaultUITableRef.assign(r)}else{throw new Error(b.getMsgText("jsdoMSG011","assign()"))}};this.display=function(r){if(this._defaultUITableRef){this._defaultUITableRef.display(r)}else{throw new Error(b.getMsgText("jsdoMSG011","display()"))}};this.showListView=function(){if(this._defaultUITableRef){this._defaultUITableRef.showListView()}else{throw new Error(b.getMsgText("jsdoMSG011","showListView()"))}};this.getFormFields=function(r){if(this._defaultUITableRef){return this._defaultUITableRef.getFormFields(r)}else{throw new Error(b.getMsgText("jsdoMSG011","getFormFields()"))}};this.getListViewRecord=function(r){if(this._defaultUITableRef){return this._defaultUITableRef.getListViewRecord(r)}else{throw new Error(b.getMsgText("jsdoMSG011","getListViewRecord()"))}};this.getFormRecord=function(r){if(this._defaultUITableRef){return this._defaultUITableRef.getFormRecord(r)}else{throw new Error(b.getMsgText("jsdoMSG011","getFormRecord()"))}};this.setDetailPage=function(r){if(this._defaultUITableRef){return this._defaultUITableRef.setDetailPage(r)}throw new Error(b.getMsgText("jsdoMSG011","setDetailPage()"))};this.setListView=function(r){if(this._defaultUITableRef){return this._defaultUITableRef.setListView(r)}throw new Error(b.getMsgText("jsdoMSG011","setListView()"))}};progress.ui.UIHelper._defaultItemTemplate='<li data-theme="c" data-id="{__id__}"><a href="#{__page__}" class="ui-link" data-transition="slide">{__format__}</a></li>';progress.ui.UIHelper._defaultFieldTemplate='<div data-role="fieldcontain"><label for="{__name__}">{__label__}</label><input id="{__name__}" name="{__name__}" placeholder="" value="" type="text" /></div>';progress.ui.UIHelper._itemTemplate=progress.ui.UIHelper._defaultItemTemplate;progress.ui.UIHelper._fieldTemplate=progress.ui.UIHelper._defaultFieldTemplate;progress.ui.UIHelper.setItemTemplate=function(n){progress.ui.UIHelper._itemTemplate=n?n:progress.ui.UIHelper._defaultItemTemplate};progress.ui.UIHelper.setFieldTemplate=function(n){progress.ui.UIHelper._fieldTemplate=n?n:progress.ui.UIHelper._defaultFieldTemplate}})();(function(){if(typeof progress=="undefined"){progress={}}if(typeof progress.data=="undefined"){progress.data={}}progress.data.ServicesManager={};progress.data.ServicesManager._services=[];progress.data.ServicesManager._resources=[];progress.data.ServicesManager._data=[];progress.data.ServicesManager._sessions=[];progress.data.ServicesManager.addResource=function(j,h){if(progress.data.ServicesManager._resources[j]===undefined){progress.data.ServicesManager._resources[j]=h}else{throw new Error("A resource named '"+j+"' was already loaded.")}};progress.data.ServicesManager.getResource=function(h){return progress.data.ServicesManager._resources[h]};progress.data.ServicesManager.addService=function(j,h){if(progress.data.ServicesManager._services[j]===undefined){progress.data.ServicesManager._services[j]=h}else{throw new Error("A service named '"+j+"' was already loaded.")}};progress.data.ServicesManager.getService=function(h){return progress.data.ServicesManager._services[h]};progress.data.ServicesManager.addSession=function(h,j){if(progress.data.ServicesManager._sessions[h]===undefined){progress.data.ServicesManager._sessions[h]=j}else{throw new Error("Cannot load catalog '"+h+"' multiple times.")}};progress.data.ServicesManager.getSession=function(h){try{return progress.data.ServicesManager._sessions[h]}catch(j){return null}};function g(j){var h=[];if(typeof(j)=="string"){var l=null;for(var k=0;k<j.length;k++){if(j.charAt(k)=="{"){l=""}else{if(j.charAt(k)=="}"){if(l){h.push(l)}l=null}else{if(l!==null){l+=j.charAt(k)}}}}}return h}progress.data.ServicesManager.addCatalog=function(h,k){if(!h){throw new Error("Cannot find 'services' property in catalog file.")}if(h instanceof Array){for(var w=0;w<h.length;w++){if(progress.data.ServicesManager.getService(h[w].name)!==undefined){throw new Error("A service named '"+h[w].name+"' was already loaded.")}var y=h[w].resources;if(y instanceof Array){for(var x=0;x<y.length;x++){if(progress.data.ServicesManager.getResource(y[x].name)!==undefined){throw new Error("A resource named '"+y[x].name+"' was already loaded.")}}}else{throw new Error("Missing 'resources' array in catalog.")}}for(var w=0;w<h.length;w++){h[w]._session=k;this.addService(h[w].name,h[w]);var y=h[w].resources;var o=h[w].address;if(y instanceof Array){for(var x=0;x<y.length;x++){var m=y[x];m.fn={};m.service=h[w];y[x].url=o+y[x].path;progress.data.ServicesManager.addResource(y[x].name,y[x]);m.fields=null;m.primaryKeys=null;if(m.schema){m.fields={};m.primaryKeys={};m._dataSetName=undefined;m._tempTableName=undefined;var r=null;try{if(typeof m.schema.properties!="undefined"){var t=Object.keys(m.schema.properties);r=m.schema.properties;if(t.length==1){if(typeof m.schema.properties[t[0]].properties!="undefined"){m._dataSetName=t[0]}else{if(typeof m.schema.properties[t[0]].items!="undefined"){m.dataProperty=t[0];r=m.schema.properties[t[0]].items.properties;m._tempTableName=m.dataProperty;m.primaryKeys[m._tempTableName]=m.schema.properties[t[0]].primaryKey}}}}else{var t=Object.keys(m.schema);if(t.length==1){m.dataProperty=t[0];if(typeof m.schema[t[0]].items!="undefined"){r=m.schema[t[0]].items.properties;m._tempTableName=m.dataProperty;m.primaryKeys[m._tempTableName]=m.schema[t[0]].primaryKey}else{if(typeof m.schema[t[0]].properties!="undefined"){m._dataSetName=t[0];m.dataProperty=null;r=m.schema}}}}}catch(z){throw new Error("Error parsing catalog file.")}if(r){if(m._dataSetName){r=r[m._dataSetName].properties;for(var p in r){m.fields[p]=[];m.primaryKeys[p]=r[p].primaryKey;var n;if(r[p].items&&r[p].items.properties){n=r[p].items.properties}else{n=r[p].properties}for(var l in n){n[l].name=l;if(l!="_id"){m.fields[p].push(n[l])}}}}else{var p=m.dataProperty?m.dataProperty:"";m.fields[p]=[];for(var l in r){r[l].name=l;if(l!="_id"){m.fields[p].push(r[l])}}}}else{throw new Error("Error parsing catalog file.")}}else{m.fields=null}if((m.relations instanceof Array)&&m.relations[0]&&m.relations[0].RelationName){throw new Error("Relationship properties in catalog must begin with lowercase.")}m.generic={};if(m.operations){for(var u=0;u<m.operations.length;u++){if(m.operations[u].path){m.operations[u].url=m.url+m.operations[u].path}else{m.operations[u].url=m.url}if(!m.operations[u].params){m.operations[u].params=[]}if(!m.operations[u].type){m.operations[u].type="INVOKE"}var v=m.operations[u].type.toLowerCase();if(!m.operations[u].verb){switch(v){case"create":m.operations[u].verb="POST";break;case"read":m.operations[u].verb="GET";break;case"update":case"invoke":case"submit":m.operations[u].verb="PUT";break;case"delete":m.operations[u].verb="DELETE";break;default:break}}var q=function s(D,C){var P;if(typeof s.fnName=="undefined"){s.fnName=arguments[0];s.definition=arguments[1];return}var L=null;var B=s.definition.url;var J=this;var O=null;var E={};if(D){if(typeof(D)!="object"){throw new Error("Catalog error: Function '"+s.fnName+"' requires an object as a parameter.")}var M;if(D instanceof XMLHttpRequest){J=D.jsdo;O=D;M=O.objParam;E=O.request}else{M=D}if(typeof C=="undefined"){C=this._async}else{C=Boolean(C)}E.objParam=M;var Q=(s.definition.type.toUpperCase()=="INVOKE");for(var G=0;G<s.definition.params.length;G++){var j=s.definition.params[G].name;switch(s.definition.params[G].type){case"PATH":case"QUERY":case"MATRIX":var K=null;if(M){K=M[j]}if(!K){K=""}if(B.indexOf("{"+j+"}")==-1){throw new Error("Catalog error: Reference to "+s.definition.params[G].type+" parameter '"+j+"' is missing in path.")}B=B.replace(new RegExp("{"+j+"}","g"),encodeURIComponent(K));break;case"REQUEST_BODY":case"REQUEST_BODY,RESPONSE_BODY":case"RESPONSE_BODY,REQUEST_BODY":if(O&&!L){L=M}else{var N=M[j];if(Q&&(s.definition.params[G].xType&&("DATASET,TABLE".indexOf(s.definition.params[G].xType)!=-1))){var I=(J._resource.service.settings&&J._resource.service.settings.unwrapped);if(I){if((typeof(N)=="object")&&(Object.keys(N).length==1)&&(typeof(N[j])=="object")){N=N[j]}}else{if((typeof(N)=="object")&&(typeof(N[j])=="undefined")){N={};N[j]=M[j]}}}if(!L){L={}}L[j]=N}break;case"RESPONSE_BODY":break;default:throw new Error("Catalog error: Unexpected parameter type '"+s.definition.params[G].type+"'.")}}if(B.indexOf("{")!=-1){var H=g(B);for(var G=0;G<H.length;G++){var j=H[G];var K=null;if(M){K=M[j]}if(!K){K=""}if(typeof(K)==="object"){K=JSON.stringify(K)}B=B.replace(new RegExp("{"+j+"}","g"),encodeURIComponent(K))}}}E.fnName=s.fnName;E.async=C;if(E.deferred===undefined&&typeof($)=="function"&&typeof($.Deferred)=="function"){P=$.Deferred();E.deferred=P}var F=J._httpRequest(O,s.definition.verb,B,L,E,C);return F};switch(m.operations[u].verb.toLowerCase()){case"get":case"post":case"put":case"delete":break;default:throw new Error("Catalog error: Unexpected HTTP verb '"+m.operations[u].verb+"' found while parsing the catalog.")}switch(v){case"invoke":break;case"create":case"read":case"update":case"delete":case"submit":if(typeof(m.generic[v])=="function"){throw new Error("Catalog error: Multiple '"+m.operations[u].type+"' operations specified in the catalog for resource '"+m.name+"'.")}else{m.generic[v]=q}break;default:throw new Error("Catalog error: Unexpected operation '"+m.operations[u].type+"' found while parsing the catalog.")}var A=m.operations[u].name;if(v=="invoke"){m.fn[A]={};m.fn[A]["function"]=q}else{A="_"+v}q(A,m.operations[u])}}}}}}else{throw new Error("Missing 'services' array in catalog.")}};progress.data.ServicesManager.printDebugInfo=function(j){if(j){var k=progress.data.ServicesManager.getResource(j);if(k){var n="Schema:\n";var m="Operations: "+k.operations.length+"\n";for(var l in k.schema.properties){n+="\nName: "+l+"\n"}for(var h=0;h<k.operations.length;h++){m+="\n"+h+"\nName: "+k.operations[h].name+"\nURL: "+k.operations[h].url+"\ntype: "+k.operations[h].type+"\nverb: "+k.operations[h].verb+"\nparams: "+k.operations[h].params.length+"\n"}console.log("** DEBUG INFO **\nResource name: %s\nURL:%s\n%s\n%s\n\n",k.name,k.url,n,m)}else{console.log("Resource not found")}}};progress.data.MobileServiceObject=function b(j){var h=j.name;Object.defineProperty(this,"name",{get:function(){return h},enumerable:true});var k=j.uri;Object.defineProperty(this,"uri",{get:function(){return k},enumerable:true})};progress.data.Session=function d(){var l=false;if((typeof Object.defineProperty)=="function"){l=true}var w=this;var O=true;var j=false;var k=false;var v="/rest/_oeping";var I=v;this._onlineHandler=function(){O=true;w.trigger("online",w,null)};this._offlineHandler=function(){O=false;w.trigger("offline",w,progress.data.Session.DEVICE_OFFLINE,null)};if((typeof window!="undefined")&&(window.addEventListener)){window.addEventListener("online",this._onlineHandler,false);window.addEventListener("offline",this._offlineHandler,false)}var u=[];var V=[];var r=[];this.onOpenRequest=null;var o=null;if(l){var ac=null;Object.defineProperty(this,"userName",{get:function(){return ac},enumerable:true});var s="/static/home.html";Object.defineProperty(this,"loginTarget",{get:function(){return s},enumerable:true});var X=null;Object.defineProperty(this,"serviceURI",{get:function(){return X},enumerable:true});Object.defineProperty(this,"catalogURIs",{get:function(){return u},enumerable:true});Object.defineProperty(this,"services",{get:function(){return V},enumerable:true});var R=null;Object.defineProperty(this,"loginResult",{get:function(){return R},enumerable:true});var aa=null;Object.defineProperty(this,"loginHttpStatus",{get:function(){return aa},enumerable:true});var B=null;Object.defineProperty(this,"clientContextId",{get:function(){return B},enumerable:true});var Y=progress.data.Session.AUTH_TYPE_ANON;Object.defineProperty(this,"authenticationModel",{get:function(){return Y},set:function(ad){if(ad){ad=ad.toLowerCase()}switch(ad){case progress.data.Session.AUTH_TYPE_FORM:case progress.data.Session.AUTH_TYPE_BASIC:case progress.data.Session.AUTH_TYPE_ANON:case null:Y=ad;break;default:throw new Error("Error setting Session.authenticationModel. '"+ad+"' is an invalid value.")}},enumerable:true});var E=null;Object.defineProperty(this,"lastSessionXHR",{get:function(){return E},enumerable:true});Object.defineProperty(this,"connected",{get:function(){return j&&O},enumerable:true});Object.defineProperty(this,"JSDOs",{get:function(){return r},enumerable:true});var m=0;var C=null;Object.defineProperty(this,"pingInterval",{get:function(){return m},set:function(ad){if(ad>=0){m=ad;if(ad>0){C=setTimeout(this._autoping,ad)}else{if(ad===0){clearTimeout(C);m=0}else{throw new Error("Error setting Session.pingInterval. '"+ad+"' is an invalid value.")}}}},enumerable:true})}else{this.userName=null;this.loginTarget="/static/home.html";this.serviceURI=null;this.catalogURIs=[];this.services=[];this.loginResult=null;this.loginHttpStatus=null;this.clientContextId=null;this.authenticationModel=progress.data.Session.AUTH_TYPE_ANON;this.lastSessionXHR=null}function N(ad,ae){if(l){ac=ad}else{ae.userName=ad}}function t(ae,ad){if(l){s=ae}else{ad.loginTarget=ae}}function x(ad,ae){if(l){X=ad}else{ae.serviceURI=ad}}function M(ad,ae){if(l){u.push(ad)}else{ae.catalogURIs.push(ad)}}function y(ae,ad){if(l){V.push(ae)}else{ad.services.push(ae)}}function n(ae){for(var af in V){var ad=V[af];if(ad.name===ae){return ad}}return null}function S(ad,ae){if(l){R=ad}else{ae.loginResult=ad}}function H(ad,ae){if(l){aa=ad}else{ae.loginHttpStatus=ad}}function Z(ae,ad){if(ae){z(ae.getResponseHeader("X-CLIENT-CONTEXT-ID"),ad)}}function z(ae,ad){if(l){B=ae}else{ad.clientContextId=ae}}function T(ae,ad){if(l){E=ae}else{ad.lastSessionXHR=ae}}this._pushJSDOs=function(ad){r.push(ad)};this._openRequest=function(ai,ah,ad,ae){if(this.loginResult!==progress.data.Session.LOGIN_SUCCESS&&this.authenticationModel){throw new Error("Attempted to make server request when there is no active session.")}var af=this._prependAppURL(ad);af=this._addCCIDtoURL(af);if(progress.data.Session._useTimeStamp){af=this._addTimeStampToURL(af)}this._setXHRCredentials(ai,ah,af,this.userName,o,ae);if(this.authenticationModel===progress.data.Session.AUTH_TYPE_FORM){F(ai,"application/json")}if(this.clientContextId&&(this.clientContextId!=="0")){ai.setRequestHeader("X-CLIENT-CONTEXT-ID",this.clientContextId)}if(this.xClientProps){ai.setRequestHeader("X-CLIENT-PROPS",this.xClientProps)}if(typeof this.onOpenRequest==="function"){var ag={xhr:ai,verb:ah,uri:af,async:ae,formPreTest:false,session:this};this.onOpenRequest(ag)}};this.pingTestCallback=function(ad){if(ad.pingResult){k=true}else{k=false}};this._onReadyStateChangeGeneric=function(){var ag=this;var ad;var ae;if(ag.readyState==4){ad=null;ae=null;if((typeof ag.onResponseFn)=="function"){try{ad=ag.onResponseFn(ag)}catch(af){ae=af}}if((typeof ag.onResponseProcessedFn)=="function"){if(!ad){ad=progress.data.Session.GENERAL_FAILURE}ag.onResponseProcessedFn(ag.pdsession,ad,ae,ag)}}};var G=null;var L=null;this.login=function(ak,ag,ah,af){var ao,an,ad=false,al=[],aq,aj;G=null;L=null;if(this.loginResult===progress.data.Session.LOGIN_SUCCESS){throw new Error("Attempted to call login() on a Session object that is already logged in.")}if(!l){this.authenticationModel=this.authenticationModel.toLowerCase()}if(arguments.length>0){if(arguments[0]&&typeof(arguments[0])==="object"){if(arguments[0].serviceURI){al[0]=arguments[0].serviceURI;al[1]=arguments[0].userName;al[2]=arguments[0].password;al[3]=arguments[0].loginTarget;al[4]=arguments[0].async;aq=arguments[0].deferred;aj=arguments[0].jsdosession}}else{al=arguments}}if(al.length>0){if(al[0]){var ar=al[0];if(ar[ar.length-1]==="/"){ar=ar.substring(0,ar.length-1)}x(ar,this)}else{S(progress.data.Session.LOGIN_GENERAL_FAILURE,this);throw new Error("Session.login() is missing the serviceURI argument.")}if(al[1]){ao=al[1]}if(al[2]){an=al[2]}if(al[3]){t(al[3],this)}if(al[4]){if(typeof(al[4])==="boolean"){ad=al[4]}else{throw new Error("Session.login() was passed an async setting that is not a boolean.")}}}else{S(progress.data.Session.LOGIN_GENERAL_FAILURE,this);throw new Error("Session.login() is missing the serviceURI argument.")}L=ao;G=an;if(this.authenticationModel===progress.data.Session.AUTH_TYPE_ANON||this.authenticationModel===progress.data.Session.AUTH_TYPE_FORM){ao=null;an=null}var ap=new XMLHttpRequest();ap.pdsession=this;try{this._setXHRCredentials(ap,"GET",this.serviceURI+this.loginTarget,ao,an,ad);ap.setRequestHeader("Cache-Control","no-cache");ap.setRequestHeader("Pragma","no-cache");if(this.xClientProps){ap.setRequestHeader("X-CLIENT-PROPS",this.xClientProps)}if(this.authenticationModel===progress.data.Session.AUTH_TYPE_FORM){F(ap,"application/json,text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8")}ap._isAsync=ad;if(ad){ap.onreadystatechange=this._onReadyStateChangeGeneric;if(this.authenticationModel===progress.data.Session.AUTH_TYPE_FORM){ap.onResponseFn=this._afterFormPretestLogin}else{ap.onResponseFn=this._processLoginResult;ap.onResponseProcessedFn=this._loginComplete}ap._jsdosession=aj;ap._deferred=aq}if(typeof this.onOpenRequest==="function"){var am=false;if(this.authenticationModel===progress.data.Session.AUTH_TYPE_FORM){am=true}T(ap,this);var ae={xhr:ap,verb:"GET",uri:this.serviceURI+this.loginTarget,async:false,formPreTest:am,session:this};this.onOpenRequest(ae);ap=ae.xhr}T(ap,this);ap.send(null)}catch(ai){H(ap.status,this);S(progress.data.Session.LOGIN_GENERAL_FAILURE,this);L=null;G=null;throw ai}if(ad){return progress.data.Session.ASYNC_PENDING}else{H(ap.status,this);if(this.authenticationModel===progress.data.Session.AUTH_TYPE_FORM){return(this._afterFormPretestLogin(ap))}else{return(this._processLoginResult(ap))}}};this._afterFormPretestLogin=function(ag){var ad=ag.pdsession;H(ag.status,ag.pdsession);var ae={xhr:ag,pw:G,uname:L,theSession:ad};try{return q(ae)}catch(af){G=null;L=null;throw af}};function q(ag){var aj=ag.xhr;var ak=ag.theSession;var ad;var ai=null;var al=false;var ae={session:ak,xhr:aj,statusFromjson:null};ai=aj.getResponseHeader("Content-Type");if(ai&&ai.indexOf("application/json")>=0){U(ae);if(!ae.statusFromjson||ae.statusFromjson===401){al=true}else{H(ae.statusFromjson,ak)}}else{if(ak.loginHttpStatus==200){if(J(aj)){al=true}}}if(al){ad=aj;aj=new XMLHttpRequest();ag.xhr=aj;ae.xhr=aj;aj.pdsession=ad.pdsession;aj._isAsync=ad._isAsync;aj._deferred=ad._deferred;aj._jsdosession=ad._jsdosession;aj.open("POST",ak.serviceURI+"/static/auth/j_spring_security_check",aj._isAsync);aj.setRequestHeader("Content-Type","application/x-www-form-urlencoded");aj.setRequestHeader("Cache-Control","max-age=0");if(ak.xClientProps){aj.setRequestHeader("X-CLIENT-PROPS",ak.xClientProps)}F(aj,"application/json");try{if(typeof ak.onOpenRequest==="function"){var ah={xhr:aj,verb:"POST",uri:ak.serviceURI+"/static/auth/j_spring_security_check",async:aj._isAsync,formPreTest:false,session:ak};ak.onOpenRequest(ah);aj=ah.xhr}if(aj._isAsync){aj.onreadystatechange=ak._onReadyStateChangeGeneric;aj.onResponseFn=ak._afterFormLogin;aj.onResponseProcessedFn=ak._loginComplete}aj.send("j_username="+ag.uname+"&j_password="+ag.pw+"&submit=Submit")}catch(af){S(progress.data.Session.LOGIN_GENERAL_FAILURE,ak);H(aj.status,ak);L=null;G=null;throw af}}if(aj._isAsync&&!al){aj.onResponseProcessedFn=ak._loginComplete;return ak._afterFormLogin(aj)}if(!aj._isAsync){return ak._afterFormLogin(aj)}}this._afterFormLogin=function(af){var ad=af.pdsession;var ae={session:ad,xhr:af,statusFromjson:null};var ag=af.getResponseHeader("Content-Type");if(ag&&ag.indexOf("application/json")>=0){U(ae);if(!ae.statusFromjson){throw new Error("Internal OpenEdge Mobile client error handling login response. HTTP status: "+af.status+".")}else{H(ae.statusFromjson,ad)}}else{if(af.status==200||af.status===0){if(W(af)||J(af)){H(401,ad)}else{H(af.status,ad)}}}return ad._processLoginResult(af)};this._processLoginResult=function(af){var ad=af.pdsession;H(af.status,af.pdsession);if(ad.loginHttpStatus==200){S(progress.data.Session.LOGIN_SUCCESS,ad);j=true;N(L,ad);o=G;ad._saveClientContextId(af);var ae={pingURI:null,async:true,onCompleteFn:null,fireEventIfOfflineChange:true,onReadyStateFn:ad._pingtestOnReadyStateChange};ae.pingURI=ad._makePingURI();ad._sendPing(ae)}else{if(ad.loginHttpStatus==401){S(progress.data.Session.LOGIN_AUTHENTICATION_FAILURE,ad)}else{S(progress.data.Session.LOGIN_GENERAL_FAILURE,ad)}}T(af,ad);L=null;G=null;return ad.loginResult};this._loginComplete=function(ae,ad,af,ag){ae.trigger("afterLogin",ae,ad,af,ag)};this.logout=function(){var ag=false,af=null,aj,ad,ae;if(this.loginResult!==progress.data.Session.LOGIN_SUCCESS&&this.authenticationModel){throw new Error("Attempted to call logout when there is no active session.")}if(arguments.length>0){if(typeof(arguments[0])==="object"){ag=arguments[0].async;if(ag&&(typeof ag!="boolean")){throw new Error(progress.data._getMsgText("jsdoMSG033","Session","logout","The async argument was invalid."))}ad=arguments[0].deferred;ae=arguments[0].jsdosession}}aj=new XMLHttpRequest();aj.pdsession=this;try{aj._jsdosession=ae;aj._deferred=ad;if(this.authenticationModel===progress.data.Session.AUTH_TYPE_FORM||this.authenticationModel===progress.data.Session.AUTH_TYPE_BASIC){if(ag){aj.onreadystatechange=this._onReadyStateChangeGeneric;aj.onResponseFn=this._processLogoutResult;aj.onResponseProcessedFn=this._logoutComplete}aj.open("GET",this.serviceURI+"/static/auth/j_spring_security_logout",ag);try{aj.withCredentials=true}catch(ah){}aj.setRequestHeader("Accept","application/json");if(this.xClientProps){aj.setRequestHeader("X-CLIENT-PROPS",this.xClientProps)}if(typeof this.onOpenRequest==="function"){T(aj,this);var ai={xhr:aj,verb:"GET",uri:this.serviceURI+"/static/auth/j_spring_security_logout",async:false,formPreTest:false,session:this};this.onOpenRequest(ai);aj=ai.xhr}T(aj,this);aj.send()}else{aj._anonymousLogoutOK=true}}catch(ah){this._reinitializeAfterLogout(this,false);throw ah}if(!ag){try{this._processLogoutResult(aj)}catch(ah){throw ah}}if(ag&&this.authenticationModel===progress.data.Session.AUTH_TYPE_ANON){try{this._processLogoutResult(aj)}catch(ah){af=ah}this._logoutComplete(this,null,af,aj)}};this._logoutComplete=function(ae,ad,af,ag){ae.trigger("afterLogout",ae,af,ag)};this._processLogoutResult=function(af){var ae;var ad=af.pdsession;var ag=false;if(af._anonymousLogoutOK){ae=true}else{if((af.status!=200)&&(af.status!==0)){if(ad.authenticationModel===progress.data.Session.AUTH_TYPE_BASIC){if(af.status===404){ae=true}else{ae=false;throw new Error("Error logging out, HTTP status = "+af.status)}}}else{ae=true}}ad._reinitializeAfterLogout(ad,ae)};this._reinitializeAfterLogout=function(ad,ae){S(null,ad);H(null,ad);z(null,ad);N(null,ad);o=null;if(ae){k=false;I=v;T(null,ad)}};this.addCatalog=function(){var al,ad,ae,af=false,ak,am,ai,aj;if(arguments.length>0){if(typeof(arguments[0])==="object"){if(!arguments[0].offlineAddCatalog){if(this.loginResult!==progress.data.Session.LOGIN_SUCCESS&&this.authenticationModel){throw new Error("Attempted to call addCatalog when there is no active session.")}}al=arguments[0].catalogURI;if(!al||(typeof al!="string")){throw new Error(progress.data._getMsgText("jsdoMSG033","Session","addCatalog","The catalogURI argument was missing or invalid."))}ad=arguments[0].userName;if(ad&&(typeof ad!="string")){throw new Error(progress.data._getMsgText("jsdoMSG033","Session","addCatalog","The catalogUserName argument was invalid."))}ae=arguments[0].password;if(ae&&(typeof ae!="string")){throw new Error(progress.data._getMsgText("jsdoMSG033","Session","addCatalog","The catalogPassword argument was invalid."))}af=arguments[0].async;if(af&&(typeof af!="boolean")){throw new Error(progress.data._getMsgText("jsdoMSG033","Session","addCatalog","The async argument was invalid."))}am=arguments[0].deferred;ai=arguments[0].jsdosession;aj=arguments[0].catalogIndex}else{al=arguments[0];if(typeof al!="string"){throw new Error("First argument to Session.addCatalog must be the URL of the catalog.")}ad=arguments[1];if(ad&&(typeof ad!="string")){throw new Error("Second argument to Session.addCatalog must be a user name string.")}ae=arguments[2];if(ae&&(typeof ae!="string")){throw new Error("Third argument to Session.addCatalog must be a password string.")}}}else{throw new Error("Session.addCatalog is missing its first argument, the URL of the catalog.")}if(!ad){ad=this.userName}if(!ae){ae=o}ak=new XMLHttpRequest();ak.pdsession=this;ak._catalogURI=al;if(progress.data.ServicesManager.getSession(al)!==undefined){if(af){ak._jsdosession=ai;ak._deferred=am;ak._catalogIndex=aj;setTimeout(this._addCatalogComplete,10,this,progress.data.Session.CATALOG_ALREADY_LOADED,null,ak);return progress.data.Session.ASYNC_PENDING}return progress.data.Session.CATALOG_ALREADY_LOADED}this._setXHRCredentials(ak,"GET",al,ad,ae,af);ak.setRequestHeader("Cache-Control","no-cache");ak.setRequestHeader("Pragma","no-cache");if(this.xClientProps){ak.setRequestHeader("X-CLIENT-PROPS",this.xClientProps)}if(this.authenticationModel===progress.data.Session.AUTH_TYPE_FORM){F(ak,"application/json")}if(af){ak.onreadystatechange=this._onReadyStateChangeGeneric;ak.onResponseFn=this._processAddCatalogResult;ak.onResponseProcessedFn=this._addCatalogComplete;ak._jsdosession=ai;ak._deferred=am;ak._catalogIndex=aj}try{if(typeof this.onOpenRequest==="function"){T(ak,this);var ag={xhr:ak,verb:"GET",uri:al,async:false,formPreTest:false,session:this};this.onOpenRequest(ag);ak=ag.xhr}T(ak,this);ak.send(null)}catch(ah){throw new Error("Error retrieving catalog '"+al+"'.\n"+ah.message)}if(af){return progress.data.Session.ASYNC_PENDING}else{return this._processAddCatalogResult(ak)}};this._processAddCatalogResult=function(ak){var ae=ak.status;var af=ak.pdsession;var ad;var ah=ak._catalogURI;T(ak,af);if((ae==200)||(ae===0)){ad=af._parseCatalog(ak);var aj;try{progress.data.ServicesManager.addCatalog(ad,af)}catch(ai){if(progress.data.ServicesManager.getSession(ah)!==undefined){return progress.data.Session.CATALOG_ALREADY_LOADED}throw new Error("Error processing catalog '"+ah+"'. \n"+ai.message)}for(var ag=0;ag<ad.length;ag++){aj=af._prependAppURL(ad[ag].address);y(new progress.data.MobileServiceObject({name:ad[ag].name,uri:aj}),af);if(ad[ag].settings&&ad[ag].settings.useXClientProps&&!af.xClientProps){console.warn("Catalog warning: Service settings property 'useXClientProps' is true but 'xClientProps' property has not been set.")}}M(ah,af);progress.data.ServicesManager.addSession(ah,af)}else{if(ae==401){return progress.data.Session.AUTHENTICATION_FAILURE}else{throw new Error("Error retrieving catalog '"+ah+"'. Http status: "+ae+".")}}return progress.data.Session.SUCCESS};this._addCatalogComplete=function(ae,ad,af,ag){ae.trigger("afterAddCatalog",ae,ad,af,ag)};this.ping=function(ad){var ae=false;var af={pingURI:null,async:true,onCompleteFn:null,fireEventIfOfflineChange:true,onReadyStateFn:this._onReadyStateChangePing,offlineReason:null};if(ad){if(ad.async!==undefined){af.async=ad.async}if(ad.doNotFireEvent!==undefined){af.fireEventIfOfflineChange=!ad.doNotFireEvent}if(ad.onCompleteFn&&(typeof ad.onCompleteFn)=="function"){af.onCompleteFn=ad.onCompleteFn}af.deferred=ad.deferred;af.jsdosession=ad.jsdosession}af.pingURI=w._makePingURI();w._sendPing(af);if(!af.async){if(af.xhr){ae=w._processPingResult(af);if(ad.offlineReason!==undefined){ad.offlineReason=af.offlineReason}}else{ae=false}}return ae};this._isOnlineStateChange=function(ae){var ad=false;if(ae&&!(this.connected)){ad=true}else{if(!ae&&(this.connected)){ad=true}}return ad};this._checkServiceResponse=function(ai,ah,af){var ad=null;var ak=this.connected;if(!this._events){return}var ae=this._events.offline||[];var aj=this._events.online||[];if((ae.length===0)&&(aj.length===0)){return}if(ah){j=true;O=true}else{if(O){var ag={doNotFireEvent:true,offlineReason:null,async:false};if(!(w.ping(ag))){ad=ag.offlineReason;j=false}else{j=true}}}if(ak&&!this.connected){this.trigger("offline",this,ad,af)}else{if(!ak&&this.connected){this.trigger("online",this,af)}}};this._processPingResult=function(ad){var ah=ad.xhr;var ag;var ae=null;var ai=this.connected;if(ah.status>=200&&ah.status<300){if(k){try{ag=JSON.parse(ah.responseText);ae=ag.AppServerStatus}catch(af){console.error("Unable to parse ping response.")}}j=true}else{if(O){if(ah.status===0){ad.offlineReason=progress.data.Session.SERVER_OFFLINE;j=false}else{if((ah.status===404)||(ah.status===410)){ad.offlineReason=progress.data.Session.WEB_APPLICATION_OFFLINE;j=false}else{j=true}}}else{ad.offlineReason=progress.data.Session.DEVICE_OFFLINE}}if(ae){if(ae.PingStatus==="false"){ad.offlineReason=progress.data.Session.APPSERVER_OFFLINE;j=false}else{j=true}}if((typeof ah.onCompleteFn)=="function"){ah.onCompleteFn({pingResult:this.connected,xhr:ah,offlineReason:ad.offlineReason})}if(ad.fireEventIfOfflineChange){if(ai&&!this.connected){w.trigger("offline",w,ad.offlineReason,null)}else{if(!ai&&this.connected){w.trigger("online",w,null)}}}return this.connected};this._onReadyStateChangePing=function(){var ae=this;var ad;if(ae.readyState==4){ad={xhr:ae,fireEventIfOfflineChange:true,offlineReason:null};w._processPingResult(ad);if(m>0){C=setTimeout(w._autoping,m)}}};this._pingtestOnReadyStateChange=function(){var ad=this;if(ad.readyState==4){if(ad.status>=200&&ad.status<300){k=true}else{k=false;I=w.loginTarget;console.warn("Default ping target not available, will use loginTarget instead.")}}};this._sendPing=function(ad){var af=new XMLHttpRequest();try{this._setXHRCredentials(af,"GET",ad.pingURI,this.userName,o,ad.async);if(ad.async){af.onreadystatechange=ad.onReadyStateFn;af.onCompleteFn=ad.onCompleteFn;af._jsdosession=ad.jsdosession;af._deferred=ad.deferred}af.setRequestHeader("Cache-Control","no-cache");af.setRequestHeader("Pragma","no-cache");if(this.xClientProps){af.setRequestHeader("X-CLIENT-PROPS",this.xClientProps)}if(this.authenticationModel===progress.data.Session.AUTH_TYPE_FORM){F(af,"application/json,text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8")}af.send(null)}catch(ae){ad.error=ae}ad.xhr=af};this._makePingURI=function(){var ad=this.serviceURI+I;ad=this._addTimeStampToURL(ad);return ad};this._autoping=function(){w.ping({async:true})};this._setXHRCredentials=function(aj,ai,ag,ah,ad,ae){if(ah&&this.authenticationModel===progress.data.Session.AUTH_TYPE_BASIC){aj.open(ai,ag,ae,ah,ad);var af=ab(ah,ad);aj.setRequestHeader("Authorization",af)}else{aj.open(ai,ag,ae)}};this._addCCIDtoURL=function(ae){if(this.clientContextId&&(this.clientContextId!=="0")){if(ae.substring(0,this.serviceURI.length)==this.serviceURI){var af="JSESSIONID="+this.clientContextId+";";var ad=ae.indexOf("?");if(ad==-1){ae+="?"+af}else{ae=ae.substring(0,ad+1)+af+ae.substring(ad+1)}}}return ae};var D=999999999999999;var h=D;var Q=0;var P=0;this._getNextTimeStamp=function(){var ad=++h;if(ad>=D){h=ad=1;var ae=Math.floor((Date.now?Date.now():(new Date().getTime()))/10000);if(Q==ae){P++;if(P>=D){P=1}}else{Q=ae;Math.random();P=Math.round(Math.random()*10000000000)}}return Q+"-"+P+"-"+ad};this._addTimeStampToURL=function(ae){var ad="_ts="+this._getNextTimeStamp();ae+=((ae.indexOf("?")==-1)?"?":"&")+ad;return ae};this._saveClientContextId=function(ad){Z(ad,this)};this._parseCatalog=function(ag){var ae;var ad;try{ae=JSON.parse(ag.responseText);ad=ae.services}catch(af){console.error("Unable to parse response. Make sure catalog has correct format.");ad=null}return ad};this._prependAppURL=function(ae){if(!ae){return this.serviceURI}var af=ae;var ad=/^https?:\/\//i;if(!ad.test(af)){if(af.indexOf("/")!==0){af="/"+af}af=this.serviceURI+af}return af};function F(af,ad){try{af.withCredentials=true;af.setRequestHeader("Accept",ad)}catch(ae){}}function ab(ae,af){var ad=ae+":"+af;var ag=btoa(ad);return"Basic "+ag}var A="j_spring_security_check";function J(ad){return K(ad,A)}var p="login failed";function W(ad){return K(ad,p)}function K(ae,ad){if(!ae.responseText){return false}var af=ae.getResponseHeader("Content-Type");if((af.indexOf("text/html")>=0)&&(ae.responseText.indexOf(ad)>=0)){return true}return false}function U(af){var ad;af.statusFromjson=null;try{ad=JSON.parse(af.xhr.responseText);if(ad.status_code!==undefined&&ad.status_txt!==undefined){af.statusFromjson=ad.status_code}}catch(ae){S(progress.data.Session.LOGIN_GENERAL_FAILURE,af.session);H(xhr.status,af.session);throw new Error("Unable to parse login response from server.")}}};progress.data.Session._useTimeStamp=true;if((typeof Object.defineProperty)=="function"){Object.defineProperty(progress.data.Session,"LOGIN_SUCCESS",{value:1,enumerable:true});Object.defineProperty(progress.data.Session,"LOGIN_AUTHENTICATION_FAILURE",{value:2,enumerable:true});Object.defineProperty(progress.data.Session,"LOGIN_GENERAL_FAILURE",{value:3,enumerable:true});Object.defineProperty(progress.data.Session,"CATALOG_ALREADY_LOADED",{value:4,enumerable:true});Object.defineProperty(progress.data.Session,"ASYNC_PENDING",{value:5,enumerable:true});Object.defineProperty(progress.data.Session,"SUCCESS",{value:1,enumerable:true});Object.defineProperty(progress.data.Session,"AUTHENTICATION_FAILURE",{value:2,enumerable:true});Object.defineProperty(progress.data.Session,"GENERAL_FAILURE",{value:3,enumerable:true});Object.defineProperty(progress.data.Session,"AUTH_TYPE_ANON",{value:"anonymous",enumerable:true});Object.defineProperty(progress.data.Session,"AUTH_TYPE_BASIC",{value:"basic",enumerable:true});Object.defineProperty(progress.data.Session,"AUTH_TYPE_FORM",{value:"form",enumerable:true});Object.defineProperty(progress.data.Session,"DEVICE_OFFLINE",{value:"Device is offline",enumerable:true});Object.defineProperty(progress.data.Session,"SERVER_OFFLINE",{value:"Cannot contact server",enumerable:true});Object.defineProperty(progress.data.Session,"WEB_APPLICATION_OFFLINE",{value:"Mobile Web Application is not available",enumerable:true});Object.defineProperty(progress.data.Session,"SERVICE_OFFLINE",{value:"REST web Service is not available",enumerable:true});Object.defineProperty(progress.data.Session,"APPSERVER_OFFLINE",{value:"AppServer is not available",enumerable:true})}else{progress.data.Session.LOGIN_SUCCESS=1;progress.data.Session.LOGIN_AUTHENTICATION_FAILURE=2;progress.data.Session.LOGIN_GENERAL_FAILURE=3;progress.data.Session.CATALOG_ALREADY_LOADED=4;progress.data.Session.SUCCESS=1;progress.data.Session.AUTHENTICATION_FAILURE=2;progress.data.Session.GENERAL_FAILURE=3;progress.data.Session.AUTH_TYPE_ANON="anonymous";progress.data.Session.AUTH_TYPE_BASIC="basic";progress.data.Session.AUTH_TYPE_FORM="form"}progress.data.Session.prototype=new progress.util.Observable();progress.data.Session.prototype.constructor=progress.data.Session;function a(j,h,m){m.operation=undefined;var l=false;for(var k=0;k<this._eventNames.length;k++){if(h===this._eventNames[k].toLowerCase()){l=true;break}}if(!l){throw new Error(progress.data._getMsgText("jsdoMSG042",h))}if(j.length<2){throw new Error(progress.data._getMsgText("jsdoMSG038",2))}if(typeof j[0]!=="string"){throw new Error(progress.data._getMsgText("jsdoMSG039"))}if(typeof j[1]!=="function"){throw new Error(progress.data._getMsgText("jsdoMSG040"))}else{m.fn=j[1]}if(j.length>2){if(typeof j[2]!=="object"){throw new Error(progress.data._getMsgText("jsdoMSG041",h))}else{m.scope=j[2]}}}progress.data.Session.prototype._eventNames=["offline","online","afterLogin","afterAddCatalog","afterLogout"];progress.data.Session.prototype.validateSubscribe=a;progress.data.Session.prototype.toString=function(h){return"progress.data.Session"};progress.data.JSDOSession=function c(q){var k,m,j=this;Object.defineProperty(this,"authenticationModel",{get:function(){return k?k.authenticationModel:undefined},enumerable:true});Object.defineProperty(this,"catalogURIs",{get:function(){return k?k.catalogURIs:undefined},enumerable:true});Object.defineProperty(this,"clientContextId",{get:function(){return k?k.clientContextId:undefined},enumerable:true});Object.defineProperty(this,"connected",{get:function(){return k?k.connected:undefined},enumerable:true});Object.defineProperty(this,"JSDOs",{get:function(){return k?k.JSDOs:undefined},enumerable:true});Object.defineProperty(this,"loginResult",{get:function(){return k?k.loginResult:undefined},enumerable:true});Object.defineProperty(this,"loginHttpStatus",{get:function(){return k?k.loginHttpStatus:undefined},enumerable:true});Object.defineProperty(this,"onOpenRequest",{get:function(){return k?k.onOpenRequest:undefined},set:function(r){if(k){k.onOpenRequest=r}},enumerable:true});Object.defineProperty(this,"pingInterval",{get:function(){return k?k.pingInterval:undefined},set:function(r){if(k){k.pingInterval=r}},enumerable:true});Object.defineProperty(this,"services",{get:function(){return k?k.services:undefined},enumerable:true});Object.defineProperty(this,"serviceURI",{get:function(){if(k&&k.serviceURI){return k.serviceURI}else{return m}},enumerable:true});Object.defineProperty(this,"userName",{get:function(){return k?k.userName:undefined},enumerable:true});function p(s,r,t,u){if(u&&u._deferred){if(r===progress.data.Session.SUCCESS){u._deferred.resolve(u._jsdosession,r,{errorObject:t,xhr:u})}else{u._deferred.reject(u._jsdosession,r,{errorObject:t,xhr:u})}}}function o(t,r,u,v){var s;if(v&&v._deferred){s=v._deferred;if(r!==progress.data.Session.SUCCESS&&r!==progress.data.Session.CATALOG_ALREADY_LOADED){r=r||progress.data.Session.GENERAL_FAILURE;s._overallCatalogResult=progress.data.Session.GENERAL_FAILURE}s._results[v._catalogIndex]={catalogURI:v._catalogURI,result:r,errorObject:u,xhr:v};s._numCatalogsProcessed+=1;if(s._numCatalogsProcessed===s._numCatalogs){s._processedPromise=true;if(!s._overallCatalogResult){v._deferred.resolve(v._jsdosession,progress.data.Session.SUCCESS,v._deferred._results)}else{v._deferred.reject(v._jsdosession,progress.data.Session.GENERAL_FAILURE,v._deferred._results)}}}}function l(r,s,t){if(t&&t._deferred){if(!s&&!r.loginResult){t._deferred.resolve(t._jsdosession,progress.data.Session.SUCCESS,{errorObject:s,xhr:t})}else{t._deferred.reject(t._jsdosession,progress.data.Session.SUCCESS,{errorObject:s,xhr:t})}}}function n(r){var s;if(r.xhr&&r.xhr._deferred){s=r.xhr;if(r.pingResult){s._deferred.resolve(s._jsdosession,r.pingResult,{offlineReason:r.offlineReason,xhr:s})}else{s._deferred.reject(s._jsdosession,r.pingResult,{offlineReason:r.offlineReason,xhr:s})}}}this.login=function(w,t){var s=$.Deferred(),r,u;try{k.subscribe("afterLogin",p,this);r=k.login({serviceURI:this.serviceURI,userName:w,password:t,async:true,deferred:s,jsdosession:this});if(r!==progress.data.Session.ASYNC_PENDING){u=new Error("JSDOSession: Unable to send login request.")}}catch(v){u=new Error("JSDOSession: Unable to send login request. "+v.message)}if(u){throw u}else{return s.promise()}};this.addCatalog=function(z,u,y){var A=$.Deferred(),x,s,w,t,r;if(typeof z=="string"){x=[z]}else{if(z instanceof Array){x=z}else{throw new Error(progress.data._getMsgText("jsdoMSG033","JSDOSession","addCatalog","The catalogURI parameter must be a string or an array of strings."))}}k.subscribe("afterAddCatalog",o,this);s=x.length;A._numCatalogs=s;A._numCatalogsProcessed=0;A._results=[];A._results.length=s;for(w=0;w<s;w+=1){r=undefined;t=undefined;try{t=k.addCatalog({catalogURI:x[w],async:true,userName:u,password:y,deferred:A,jsdosession:this,catalogIndex:w,offlineAddCatalog:true})}catch(v){r=new Error("JSDOSession: Unable to send addCatalog request. "+v.message)}if(t!==progress.data.Session.ASYNC_PENDING){A._overallCatalogResult=progress.data.Session.GENERAL_FAILURE;if(r){t=progress.data.Session.GENERAL_FAILURE}A._results[w]={catalogURI:x[w],result:t,errorObject:r,xhr:undefined};A._numCatalogsProcessed+=1}}if((A._numCatalogsProcessed===s)&&!A._processedPromise){if(A._overallCatalogResult===progress.data.Session.GENERAL_FAILURE){A.reject(this,progress.data.Session.GENERAL_FAILURE,A._results)}else{A.resolve(this,progress.data.Session.SUCCESS,A._results)}}return A.promise()};this.logout=function(){var r=$.Deferred();try{k.subscribe("afterLogout",l,this);k.logout({async:true,deferred:r,jsdosession:this})}catch(s){throw new Error("JSDOSession: Unable to send logout request. "+s.message)}return r.promise()};this.ping=function(){var r=$.Deferred();try{k.ping({async:true,deferred:r,jsdosession:this,onCompleteFn:n})}catch(s){throw new Error("JSDOSession: Unable to send ping request. "+s.message)}return r.promise()};this._onlineHandler=function(s,r){j.trigger("online",j,r)};this._offlineHandler=function(t,r,s){j.trigger("offline",j,r,s)};if((arguments.length>0)&&(typeof(arguments[0])==="object")){if(q.serviceURI&&(typeof(q.serviceURI)==="string")){m=q.serviceURI}else{throw new Error(progress.data._getMsgText("jsdoMSG033","JSDOSession","the constructor","The options parameter must include a 'serviceURI' property that is a string."))}if(q.authenticationModel){if(typeof(q.authenticationModel)!=="string"){throw new Error(progress.data._getMsgText("jsdoMSG033","JSDOSession","the constructor","The authenticationModel property of the options parameter must be a string."))}}}else{throw new Error(progress.data._getMsgText("jsdoMSG033","JSDOSession","the constructor","The options argument was missing or invalid."))}k=new progress.data.Session();try{if(q.authenticationModel){k.authenticationModel=q.authenticationModel}k.subscribe("online",this._onlineHandler,this);k.subscribe("offline",this._offlineHandler,this)}catch(h){k=undefined;throw h}};progress.data.JSDOSession.prototype=new progress.util.Observable();progress.data.JSDOSession.prototype.constructor=progress.data.JSDOSession;function f(j,h,m){m.operation=undefined;var l=false;for(var k=0;k<this._eventNames.length;k++){if(h===this._eventNames[k].toLowerCase()){l=true;break}}if(!l){throw new Error(progress.data._getMsgText("jsdoMSG042",h))}if(j.length<2){throw new Error(progress.data._getMsgText("jsdoMSG038",2))}if(typeof j[0]!=="string"){throw new Error(progress.data._getMsgText("jsdoMSG039"))}if(typeof j[1]!=="function"){throw new Error(progress.data._getMsgText("jsdoMSG040"))}else{m.fn=j[1]}if(j.length>2){if(typeof j[2]!=="object"){throw new Error(progress.data._getMsgText("jsdoMSG041",h))}else{m.scope=j[2]}}}progress.data.JSDOSession.prototype._eventNames=["offline","online"];progress.data.JSDOSession.prototype.validateSubscribe=f;progress.data.JSDOSession.prototype.toString=function(h){return"progress.data.JSDOSession"}})();if(typeof exports!=="undefined"){exports.progress=progress};